{"version":3,"file":"a2v10spreadsheet.min.js","sources":["../../src/components/common/utils.js","../../src/components/common/scrollbar.js","../../src/components/ssheet/canvas.js","../../src/components/ssheet/cells.js","../../src/components/ssheet/selection.js","../../src/components/ssheet/edit.js","../../src/components/ssheet/toolbar.js","../../src/components/ssheet/spreadsheet.js"],"sourcesContent":["\r\nexport const toColRef = (n) => n >= 26 ? String.fromCharCode(Math.floor(n / 26) + 64) + String.fromCharCode(n % 26 + 65) : String.fromCharCode(n + 65);\r\nexport const toPx = (n) => n + 'px';\r\n\r\nexport const rowHeaderWidth = 32;\r\nexport const columnHeaderHeigth = 23; // column header height - 1\r\n\r\nexport function fromCellRef(ref) { \r\n\tconst match = ref.match(/^([A-Z]+)(\\d+)$/);\r\n\tif (!match)\r\n\t\tthrow new Error(`Invalid cell reference: ${ref}`);\r\n\r\n\tconst c = match[1];\r\n\tconst rn = parseInt(match[2], 10);\r\n\r\n\t// (A=1, B=2, ..., Z=26, AA=27 ..)\r\n\tlet cn = 0;\r\n\tfor (let i = 0; i < c.length; i++) {\r\n\t\tcn *= 26;\r\n\t\tcn += c.charCodeAt(i) - 64; // 'A'.charCodeAt(0) === 65\r\n\t}\r\n\r\n\treturn { r: rn, c: cn - 1 };\r\n}\r\n\r\n\r\nexport function pt2Px(p) {\r\n\treturn Math.round(p * 1.33333 * 100) / 100; // pt * (96 / 72);\r\n}\r\n\r\nexport function px2Pt(px) {\r\n\treturn px * .75; // px * (72 / 96)\r\n}\r\n\r\nexport class StyleProcessor {\r\n\tconstructor(styles) {\r\n\t\tthis.styles = styles;\r\n\t\tthis.stylesMap = Object.keys(this.styles).reduce((p, c) => {\r\n\t\t\tlet st = this.styles[c];\r\n\t\t\tlet sc = this.styleHashCode(st);\r\n\t\t\tp[sc] = c;\r\n\t\t\treturn p;\r\n\t\t}, {});\r\n\t}\r\n\r\n\tdefaultStyle() {\r\n\t\treturn {};\t\t\r\n\t}\r\n\r\n\r\n\tstyleHashCode(st) {\r\n\t\tif (!st) return '-';\r\n\t\tlet b = st.Bold ? 'B' : '-';\r\n\t\tlet i = st.Italic ? 'I' : '-';\r\n\t\tlet fs = st.FontSize ? `FS${st.FontSize}` : '-';\r\n\t\tlet a = st.Align ? st.Align[0] : '-';\r\n\t\tlet va = st.VAlign ? st.VAlign[0] : '-';\r\n\t\tlet brd = st.Border || '-';\r\n\t\tlet bg = st.BackgroundColor ? `BG${st.Background}` : '-';\r\n\t\treturn `${b}:${i}:${fs}:${a}:${va}:${brd}:${bg}`;\r\n\t}\r\n\r\n\tcellClass(key) {\r\n\t\tlet st = this.styles[key];\r\n\t\tlet c = '';\r\n\t\tif (!st) return c;\r\n\t\tif (st.Bold)\r\n\t\t\tc += ' c-bold';\r\n\t\tif (st.Italic)\r\n\t\t\tc += ' c-italic';\r\n\t\tif (st.Align)\r\n\t\t\tc += ` c-text-${st.Align.toLowerCase()}`;\r\n\t\tif (st.VAlign)\r\n\t\t\tc += ` c-align-${st.VAlign.toLowerCase()}`;\r\n\t\treturn c;\r\n\t}\r\n\r\n\tcellStyle(key) {\r\n\t\tlet st = this.styles[key];\r\n\t\tlet c = {};\r\n\t\tif (!st) return c;\r\n\t\tif (st.FontSize)\r\n\t\t\tc.fontSize = `${st.FontSize}pt`;\r\n\t\tif (st.FontName) {\r\n\t\t\tc.fontFamily = st.FontName;\r\n\t\t\tconsole.dir(c);\r\n\t\t}\r\n\r\n\t\tfunction setBorder(name, val) {\r\n\t\t\tval = +val;\r\n\t\t\tif (!val)\r\n\t\t\t\treturn;\r\n\t\t\tif (val === .2)\r\n\t\t\t\tc[name] = \"1px solid black\";\r\n\t\t\telse if (val === 1)\r\n\t\t\t\tc[name] = \"2px solid black\";\r\n\t\t}\r\n\r\n\t\tif (st.Border) {\r\n\t\t\tlet bx = st.Border.split(',');\r\n\t\t\tif (bx.length === 1) {\r\n\t\t\t\tif (+bx[0] === 0.2)\r\n\t\t\t\t\tc.border = \"1px solid black\";\r\n\t\t\t\telse if (+bx[0] === 1)\r\n\t\t\t\t\tc.border = \"3px solid black\";\r\n\t\t\t}\r\n\t\t\telse if (bx.length === 4) {\r\n\t\t\t\tsetBorder('borderTop', bx[0]);\r\n\t\t\t\tsetBorder('borderRight', bx[1]);\r\n\t\t\t\tsetBorder('borderBottom', bx[2]);\r\n\t\t\t\tsetBorder('borderLeft', bx[3]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (st.Background)\r\n\t\t\tc.backgroundColor = \"#\" + st.Background;\r\n\t\treturn c;\r\n\t}\r\n\r\n\tcellStyle2(key) {\r\n\t\tlet st = this.styles[key];\r\n\t\tlet c = {};\r\n\t\tif (!st) return c;\r\n\t\tif (st.FontSize)\r\n\t\t\tc.fontSize = `${st.FontSize}pt`;\r\n\t\tif (st.FontName) {\r\n\t\t\tc.fontFamily = st.FontName;\r\n\t\t}\r\n\t\tif (st.Background)\r\n\t\t\tc.backgroundColor = \"#\" + st.Background;\r\n\t\treturn c;\r\n\t}\r\n\r\n\tappendNewStyle(styleObj, hashCode) {\r\n\t\tfunction getNextKey(obj) {\r\n\t\t\tlet i = 1;\r\n\t\t\twhile (obj.hasOwnProperty(`S${i}`)) {\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\t\t\treturn `S${i}`;\r\n\t\t}\r\n\t\tlet skey = getNextKey(this.styles);\r\n\t\tVue.set(this.styles, skey, styleObj);\r\n\t\tthis.stylesMap[hashCode] = skey;\r\n\t\treturn skey;\r\n\t}\r\n\r\n\tsetStyleProp(st, prop, val) {\r\n\t\tlet sobj = Object.assign({}, this.styles[st] || this.defaultStyle());\r\n\t\tsobj[prop] = val;\r\n\t\tlet shc = this.styleHashCode(sobj);\r\n\t\tif (shc === '-:-:-:-:-:-')\r\n\t\t\treturn undefined;\r\n\t\tlet ns = this.stylesMap[shc];\r\n\t\treturn ns || this.appendNewStyle(sobj, shc);\r\n\t}\r\n};\r\n","\r\nimport { toPx } from './utils';\r\n\r\nVue.component('a2-scroll-bar', {\r\n\ttemplate: `\r\n<div class=\"a2-sb\" :class=\"sbClass\">\r\n\t<button @click.stop=dec :disabled=decDisabled v-text=decLabel></button>\r\n\t<div class=\"sb-body\" @click.self=\"clickBody\" ref=body>\r\n\t\t<div class=\"thumb\" @pointerdown.self.stop=thumbDown\r\n\t\t\t@pointerup.self.stop=thumbUp @pointermove.self.stop=thumbMove\r\n\t\t\t:style=thumbStyle :class=\"{horz: horz, vert: !horz }\"></div>\r\n\t</div>\r\n\t<button @click.stop=inc :disabled=incDisabled v-text=incLabel></button>\r\n</div>\r\n`,\r\n\tprops: {\r\n\t\thorz: Boolean,\r\n\t\tpage: Number,\r\n\t\tpos: Number,\r\n\t\tmin: Number,\r\n\t\tmax: Number,\r\n\t\tsetPos: Function\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\ttempClientSize: 0,\r\n\t\t\tmoving: false,\r\n\t\t\tdelta: 0,\r\n\t\t\tthumbMovePos: 0\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tsbClass() {\r\n\t\t\treturn this.horz ? 'horz' : 'vert';\r\n\t\t},\r\n\t\tthumbPos() {\r\n\t\t\tif (this.moving)\r\n\t\t\t\treturn this.thumbMovePos;\r\n\t\t\tlet step = (this.clientSize) / (this.size);\r\n\t\t\treturn step * (this.pos - this.min);\r\n\t\t},\r\n\t\tsize() {\r\n\t\t\treturn this.max - this.min;\r\n\t\t},\r\n\t\tclientSize() {\r\n\t\t\tlet s = this.tempClientSize;\r\n\t\t\tif (this.$refs.body)\r\n\t\t\t\ts = (this.horz ? this.$refs.body.clientWidth : this.$refs.body.clientHeight);\r\n\t\t\treturn s;\r\n\t\t},\r\n\t\tthumbSize() {\r\n\t\t\tlet sz = this.clientSize;\r\n\t\t\treturn this.page * sz / this.size;\r\n\t\t},\r\n\t\tthumbStyle() {\r\n\t\t\tif (this.horz)\r\n\t\t\t\treturn { left: toPx(this.thumbPos), width: toPx(this.thumbSize) };\r\n\t\t\telse\r\n\t\t\t\treturn { top: toPx(this.thumbPos), height: toPx(this.thumbSize) };\r\n\t\t},\r\n\t\tdecDisabled() {\r\n\t\t\treturn this.pos <= this.min;\r\n\t\t},\r\n\t\tincDisabled() {\r\n\t\t\treturn this.pos >= this.max - this.page;\r\n\t\t},\r\n\t\tdecLabel() { return this.horz ? '◂' : '▴'; },\r\n\t\tincLabel() { return this.horz ? '▸' : '▾'; }\r\n\t},\r\n\tmethods: {\r\n\t\tdec() {\r\n\t\t\tthis.setPosCheck(this.pos - 1);\r\n\t\t},\r\n\t\tinc() {\r\n\t\t\tthis.setPosCheck(this.pos + 1);\r\n\t\t},\r\n\t\tsetPosCheck(np) {\r\n\t\t\tif (np < this.min)\r\n\t\t\t\tnp = this.min;\r\n\t\t\tif (np > this.max - this.page)\r\n\t\t\t\tnp = this.max - this.page;\r\n\t\t\tthis.setPos(np);\r\n\t\t},\r\n\t\tclickBody(ev) {\r\n\t\t\tlet dx = this.horz ? ev.offsetX : ev.offsetY;\r\n\t\t\tlet np = 0;\r\n\t\t\tif (dx < this.thumbPos)\r\n\t\t\t\tnp = this.pos - this.page;\r\n\t\t\telse\r\n\t\t\t\tnp = this.pos + this.page;\r\n\t\t\tthis.setPosCheck(np);\r\n\t\t},\r\n\t\tthumbDown(ev) {\r\n\t\t\tev.target.setPointerCapture(ev.pointerId);\r\n\t\t\tthis.delta = this.hors ? ev.offsetX : ev.offsetY;\r\n\t\t\tthis.thumbMovePos = this.thumbPos;\r\n\t\t\tthis.moving = true;\r\n\t\t},\r\n\t\tthumbMove(ev) {\r\n\t\t\tif (!this.moving) return;\r\n\t\t\tlet rect = this.$refs.body.getBoundingClientRect();\r\n\t\t\tlet tpos = this.horz ? ev.clientX - this.delta - rect.left : ev.clientY - this.delta - rect.top;\r\n\t\t\tif (tpos < 0) tpos = 0;\r\n\t\t\tlet ths = this.thumbSize;\r\n\t\t\tlet maxPos = this.horz ? rect.width - ths : rect.height - ths;\r\n\t\t\tif (tpos > maxPos) tpos = maxPos;\r\n\t\t\tthis.thumbMovePos = tpos;\r\n\t\t},\r\n\t\tthumbUp(ev) {\r\n\t\t\tev.target.releasePointerCapture(ev.pointerId);\r\n\t\t\tlet pos = this.thumbMovePos;\r\n\t\t\tthis.moving = false;\r\n\t\t\tlet step = this.clientSize / (this.max - this.min);\r\n\t\t\tlet np = Math.min(+ (pos / step).toFixed(), this.max - this.page);\r\n\t\t\tthis.setPosCheck(np + this.min);\r\n\t\t}\r\n\t},\r\n\tmounted() {\r\n\t\tthis.tempClientSize = (this.horz ? this.$refs.body.clientWidth : this.$refs.body.clientHeight);\r\n\t}\r\n});","\r\nimport { toColRef, toPx, rowHeaderWidth, columnHeaderHeigth, px2Pt } from '../common/utils';\r\n\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\trType: '',\r\n\t\t\trItem: -1,\r\n\t\t\trPt: -1,\r\n\t\t\trSize: -1,\r\n\t\t\tdelta: 0,\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tclearData() {\r\n\t\t\tthis.rType = '';\r\n\t\t\tthis.rItem = -1;\r\n\t\t\tthis.rSize = 0;\r\n\t\t\tthis.rPt = 0;\r\n\t\t\tthis.delta = 0;\r\n\t\t},\r\n\t\tonUp(ev, cb) {\r\n\t\t\tev.target.releasePointerCapture(ev.pointerId);\r\n\t\t\tev.stopPropagation();\r\n\t\t\tif (this.rItem < 0)\r\n\t\t\t\treturn;\r\n\t\t\tlet ns = this.rPt - this.rSize;\r\n\t\t\tif (ns < 5)\r\n\t\t\t\tns = 5;\r\n\t\t\tcb(ns)\r\n\t\t\tthis.clearData();\r\n\t\t},\r\n\t\thMouseDown(ev) {\r\n\t\t\tev.stopPropagation();\r\n\t\t\tlet ep = this.$parent.pointFromEvent(ev);\r\n\t\t\tlet col = this.$parent.colFromPoint(ep.x);\r\n\t\t\tif (!col) return;\r\n\t\t\tev.target.setPointerCapture(ev.pointerId);\r\n\t\t\tthis.rType = 'C';\r\n\t\t\tthis.rItem = col.col;\r\n\t\t\tthis.rPt = col.left + col.width;\r\n\t\t\tthis.rSize = col.left;\r\n\t\t\tthis.delta = this.rPt - ev.clientX;\r\n\t\t},\r\n\t\thMouseUp(ev) {\r\n\t\t\tthis.onUp(ev, nw => {\r\n\t\t\t\tlet cw = px2Pt(nw);\r\n\t\t\t\t// TODO: check DEFAULT width\r\n\t\t\t\tlet col = this.$parent.getOrCreateColumn(this.rItem);\r\n\t\t\t\tVue.set(col, 'Width', cw);\r\n\t\t\t});\r\n\t\t},\r\n\t\thMouseMove(ev) {\r\n\t\t\tif (this.rItem < 0)\r\n\t\t\t\treturn;\r\n\t\t\tthis.rPt = ev.clientX + this.delta;\r\n\t\t},\r\n\t\tvMouseDown(ev) {\r\n\t\t\tev.stopPropagation();\r\n\t\t\tlet ep = this.$parent.pointFromEvent(ev);\r\n\t\t\tlet row = this.$parent.rowFromPoint(ep.y);\r\n\t\t\tif (!row) return;\r\n\t\t\tev.target.setPointerCapture(ev.pointerId);\r\n\t\t\tthis.rType = 'R';\r\n\t\t\tthis.rItem = row.row;\r\n\t\t\tthis.rPt = row.top + row.height;\r\n\t\t\tthis.rSize = row.top;\r\n\t\t\tthis.delta = this.rPt - ev.clientY;\r\n\t\t},\r\n\t\tvMouseUp(ev) {\r\n\t\t\tthis.onUp(ev, nh => {\r\n\t\t\t\tlet row = this.$parent.getOrCreateRow(this.rItem);\r\n\t\t\t\tVue.set(row, 'Height', px2Pt(nh));\r\n\t\t\t});\r\n\t\t},\r\n\t\tvMouseMove(ev) {\r\n\t\t\tif (this.rItem < 0)\r\n\t\t\t\treturn;\r\n\t\t\tthis.rPt = ev.clientY + this.delta;\r\n\t\t},\r\n\t},\r\n\trender(h) {\r\n\t\tlet parent = this.$parent;\r\n\t\tlet sh = parent.sheet;\r\n\t\tlet cont = parent.$refs.container;\r\n\t\tif (!cont)\r\n\t\t\treturn;\r\n\t\tlet maxWidth = cont.clientWidth;\r\n\t\tlet maxHeigth = cont.clientHeight;\r\n\t\tlet elems = [];\r\n\t\tlet self = this;\r\n\t\tlet startX = parent.startX;\r\n\r\n\t\tlet maxPos = { right: 0, bottom: 0 };\r\n\r\n\t\tfunction vLines() {\r\n\t\t\tlet x = startX; // row header width\r\n\t\t\tfor (const c of parent.renderedColumns()) {\r\n\t\t\t\tx += parent.colWidth(c);\r\n\t\t\t\tif (x >= maxWidth)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tlet cls = 'vline';\r\n\t\t\t\tif (c == sh.FixedColumns - 1)\r\n\t\t\t\t\tcls += ' freeze';\r\n\t\t\t\telems.push(h('div', { class: cls, style: { left: toPx(x), height: toPx(maxPos.bottom) } }));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction hLines() {\r\n\t\t\tlet y = columnHeaderHeigth;\r\n\t\t\tfor (const r of parent.renderedRows()) {\r\n\t\t\t\tlet rh = parent.rowHeight(r);\r\n\t\t\t\ty += rh;\r\n\t\t\t\tif (y >= maxHeigth)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tlet cls = 'hline';\r\n\t\t\t\tif (r === sh.FixedRows - 1)\r\n\t\t\t\t\tcls += ' freeze';\r\n\t\t\t\telems.push(h('div', { class: cls, style: { top: toPx(y), width: toPx(maxPos.right) } }));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction topHeader() {\r\n\t\t\tlet x = startX; // row header width\r\n\t\t\tfor (const c of parent.renderedColumns()) {\r\n\t\t\t\tlet colRef = toColRef(c);\r\n\t\t\t\tlet cw = parent.colWidth(c);\r\n\t\t\t\tlet cls = 'thc';\r\n\t\t\t\tif (parent.isInSelection((sel, cell) => c >= sel.left && c <= sel.left + (cell?.ColSpan - 1 || 0)))\r\n\t\t\t\t\tcls += ' thc-sel';\r\n\t\t\t\tif (c === sh.ColumnCount - 1) {\r\n\t\t\t\t\tcls += ' last';\r\n\t\t\t\t\tcw += 1;\r\n\t\t\t\t}\r\n\t\t\t\telems.push(h('div', { class: cls, style: { width: toPx(cw), left: toPx(x) } }, [colRef,\r\n\t\t\t\t\th('div', {\r\n\t\t\t\t\t\tclass: 'h-size no-me',\r\n\t\t\t\t\t\ton: { pointerdown: self.hMouseDown, pointerup: self.hMouseUp, pointermove: self.hMouseMove }\r\n\t\t\t\t\t})]));\r\n\t\t\t\tx += cw;\r\n\t\t\t\tif (x >= maxWidth)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tmaxPos.right = x - rowHeaderWidth - 1; /* without combo! */\r\n\t\t}\r\n\r\n\t\tfunction leftHeader() {\r\n\t\t\tlet y = columnHeaderHeigth;\r\n\t\t\tfor (const r of parent.renderedRows()) {\r\n\t\t\t\tlet rh = parent.rowHeight(r);\r\n\t\t\t\tlet cls = 'thr'\r\n\t\t\t\tif (parent.isInSelection((sel, cell) => r >= sel.top && r <= sel.top + (cell?.RowSpan - 1 || 0)))\r\n\t\t\t\t\tcls += ' thr-sel'\r\n\t\t\t\tif (r === sh.RowCount - 1) {\r\n\t\t\t\t\tcls += ' last';\r\n\t\t\t\t\trh += 1;\r\n\t\t\t\t}\r\n\t\t\t\telems.push(h('div', { class: cls, style: { height: toPx(rh), top: toPx(y) } }, ['' + (r + 1),\r\n\t\t\t\th('div', {\r\n\t\t\t\t\tclass: 'v-size no-me',\r\n\t\t\t\t\ton: { pointerdown: self.vMouseDown, pointerup: self.vMouseUp, pointermove: self.vMouseMove }\r\n\t\t\t\t})]));\r\n\t\t\t\ty += rh;\r\n\t\t\t\tif (y >= maxHeigth) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tmaxPos.bottom = y - columnHeaderHeigth - 1;\r\n\t\t}\r\n\r\n\t\tif (parent.headers) {\r\n\t\t\telems.push(h('div', { class: 'r-top' }));\r\n\t\t\ttopHeader();\r\n\t\t\tleftHeader();\r\n\t\t} else if (parent.gridLines) {\r\n\t\t\tconsole.dir('calc maxPos')\r\n\t\t}\r\n\r\n\t\tif (parent.gridLines) {\r\n\t\t\tvLines();\r\n\t\t\thLines();\r\n\t\t}\r\n\r\n\t\tif (this.rItem >= 0) {\r\n\t\t\tif (this.rType == 'C')\r\n\t\t\t\telems.push(h('div', { class: 'h-resize-line', style: { left: toPx(this.rPt) } }));\r\n\t\t\telse\r\n\t\t\t\telems.push(h('div', { class: 'v-resize-line', style: { top: toPx(this.rPt) } }));\r\n\t\t}\r\n\r\n\r\n\t\treturn h('div', { class: 'canvas' }, elems);\r\n\t}\r\n};\r\n","\r\nimport { columnHeaderHeigth, toColRef, toPx } from '../common/utils';\r\n\r\nexport default {\r\n\trender(h) {\r\n\t\tlet p = this.$parent;\r\n\t\tlet sh = p.sheet;\r\n\t\tlet cont = p.$refs.container;\r\n\t\tif (!cont)\r\n\t\t\treturn;\r\n\t\tlet maxWidth = cont.clientWidth;\r\n\t\tlet maxHeigth = cont.clientHeight;\r\n\t\tlet elems = [];\r\n\t\tlet y = columnHeaderHeigth;\r\n\t\tconst startX = p.startX;\r\n\t\tfor (const r of p.renderedRows()) {\r\n\t\t\tlet x = startX;\r\n\t\t\tlet rh = this.$parent.rowHeight(r);\r\n\t\t\tfor (const c of p.renderedColumns()) {\r\n\t\t\t\tlet colRef = toColRef(c)\r\n\t\t\t\tlet cw = p.colWidth(c);\r\n\t\t\t\tconst cellRef = `${colRef}${r + 1}`;\r\n\t\t\t\tlet cell = sh.Cells[cellRef];\r\n\t\t\t\tif (cell) {\r\n\t\t\t\t\tlet nw = cw;\r\n\t\t\t\t\tlet nh = rh;\r\n\t\t\t\t\tlet cellCls = 'cell' + p.cellClass(cell);\r\n\t\t\t\t\tlet cellStyle = p.cellStyle(cell);\r\n\t\t\t\t\tif (cell.ColSpan > 1 || cell.RowSpan > 1) {\r\n\t\t\t\t\t\tfor (let sc = 1; sc < cell.ColSpan; sc++)\r\n\t\t\t\t\t\t\tnw += p.colWidth(sc + c);\r\n\t\t\t\t\t\tfor (let sr = 1; sr < cell.RowSpan; sr++)\r\n\t\t\t\t\t\t\tnh += p.rowHeight(sr + r);\r\n\t\t\t\t\t\tcellCls += ' span';\r\n\t\t\t\t\t\tlet cellStyle = { left: toPx(x + 1), top: toPx(y + 1), width: toPx(nw - 1), height: toPx(nh - 1) }\r\n\t\t\t\t\t\telems.push(h('div', {\r\n\t\t\t\t\t\t\tclass: 'cell-ph',\r\n\t\t\t\t\t\t\tstyle: cellStyle\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t}\r\n\t\t\t\t\telems.push(h('div', {\r\n\t\t\t\t\t\tclass: cellCls,\r\n\t\t\t\t\t\tstyle: Object.assign({ left: toPx(x), top: toPx(y), width: toPx(nw + 1), height: toPx(nh + 1) }, cellStyle),\r\n\t\t\t\t\t\ton: { pointerdown: (ev) => this.clickPh(c, r, cell, ev) }\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcell.Value));\r\n\t\t\t\t}\r\n\t\t\t\tx += cw;\r\n\t\t\t\tif (x >= maxWidth)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\ty += rh;\r\n\t\t\tif (y >= maxHeigth)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn h('div', { class: 'cells' }, elems);\r\n\t},\r\n\tmethods: {\r\n\t\tclickPh(c, r, cell, ev) {\r\n\t\t\tev.preventDefault();\r\n\t\t\tev.stopPropagation();\r\n\t\t\tthis.$parent.$selectCell(c, r, cell);\r\n\t\t}\r\n\t}\r\n}\r\n","\r\nimport { toPx } from '../common/utils';\r\n\r\nexport default {\r\n\trender(h) {\r\n\t\tlet sel = this.$parent.selection;\r\n\t\tlet ch = [];\r\n\t\tfor (let i = 0; i < sel.length; i++) {\r\n\t\t\tlet s = sel[i];\r\n\t\t\tlet r = this.$parent.selRect(s);\r\n\t\t\tif (r && r.left >= 0 && r.top >= 0) {\r\n\t\t\t\tfor (let cx = s.left + 1; cx < s.right; cx++)\r\n\t\t\t\t\tr.width += this.$parent.colWidth(cx);\r\n\t\t\t\tfor (let rx = s.top + 1; rx < s.bottom; rx++)\r\n\t\t\t\t\tr.height += this.$parent.rowHeight(rx);\r\n\t\t\t\tlet cls = 'sel';\r\n\t\t\t\tif (s.bottom > s.top + 1 || s.right > s.left + 1)\r\n\t\t\t\t\tcls += ' multiply';\r\n\t\t\t\tch.push(h('div', { class: cls, style: { left: toPx(r.left), top: toPx(r.top), width: toPx(r.width + 1), height: toPx(r.height + 1) } }));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn h('div', { class: 'selections' }, ch);\r\n\t}\r\n}\r\n","\r\nimport { toPx, toColRef } from '../common/utils';\r\n\r\nexport default {\r\n\tmethods: {\r\n\t\tblur(ev) {\r\n\t\t\tlet p = this.$parent;\r\n\t\t\tp.endEdit(ev.target.innerText);\r\n\t\t}\r\n\t},\r\n\trender(h) {\r\n\t\tlet p = this.$parent;\r\n\t\tlet r = p.editRect;\r\n\t\tlet cellRef = `${toColRef(r.c)}${r.r + 1}`;\r\n\t\tlet cell = p.sheet.Cells[cellRef];\r\n\t\treturn h('div', {\r\n\t\t\tclass: 'input cell cell-edit no-me' + p.cellClass(cell),\r\n\t\t\tstyle: Object.assign({\r\n\t\t\t\tleft: toPx(r.l + 1), top: toPx(r.t + 1), width: toPx(r.w - 1), height: toPx(r.h - 1),\r\n\t\t\t}, p.cellStyle2(cell)),\r\n\t\t\tdomProps: { contentEditable: true },\r\n\t\t\ton: { blur: this.blur }\r\n\t\t}, p.editText);\r\n\t},\r\n\tmounted() {\r\n\t\tthis.$el.focus();\r\n\t\tthis.$el.spellcheck = false;\r\n\t}\r\n}\r\n","\r\nconst toolbarTemplate = `\r\n<div class=\"toolbar ss-toolbar\">\r\n\t<button @click=\"toggleBool('Bold')\" :class=\"{checked: isChecked('Bold', true)}\">B</button>\r\n\t<button @click=\"toggleBool('Italic')\" :class=\"{checked: isChecked('Italic', true)}\">I</button>\r\n\t<span>|</span>\r\n\t<button @click=\"setProp('Align', '')\" :class=\"{checked: isCheckedProp('Align', '')}\">L</button>\r\n\t<button @click=\"setProp('Align', 'Center')\" :class=\"{checked: isCheckedProp('Align', 'Center')}\">C</button>\r\n\t<button @click=\"setProp('Align', 'Right')\" :class=\"{checked: isCheckedProp('Align', 'Right')}\">R</button>\r\n\t<span>|</span>\r\n\t<button @click=\"setProp('VAlign', '')\" :class=\"{checked: isCheckedProp('VAlign', '')}\">T</button>\r\n\t<button @click=\"setProp('VAlign', 'Middle')\" :class=\"{checked: isCheckedProp('VAlign', 'Middle')}\">M</button>\r\n\t<button class=\"btn btn-tb\" @click=\"setProp('VAlign', 'Bottom')\" :class=\"{checked: isCheckedProp('VAlign', 'Bottom')}\"><i class=\"ico ico-copy\" /></button>\r\n</div>\r\n`;\r\nexport default {\r\n\ttemplate: toolbarTemplate,\r\n\tprops: {\r\n\t},\r\n\tmethods: {\r\n\t\tisChecked(prop, val) {\r\n\t\t\treturn this.$parent.$getSelProp(prop, val);\r\n\t\t},\r\n\t\tisCheckedProp(prop, val) {\r\n\t\t\treturn (this.$parent.$getSelProp(prop) || '') === val;\r\n\t\t},\r\n\t\ttoggleBool(prop) {\r\n\t\t\tthis.$parent.$setSelProp(prop, !this.isChecked(prop));\r\n\t\t},\r\n\t\tsetProp(prop, val) {\r\n\t\t\tthis.$parent.$setSelProp(prop, val);\r\n\t\t}\r\n\t}\r\n}\r\n","\r\nimport spreadSheetCanvas from './canvas';\r\nimport spreadSheetCells from './cells';\r\nimport spreadSheetSelection from './selection';\r\nimport spreadSheetEdit from './edit';\r\nimport spreadSheetToolbar from './toolbar';\r\n\r\nimport {\r\n\ttoColRef, fromCellRef, rowHeaderWidth, columnHeaderHeigth, StyleProcessor,\r\n\tpt2Px\r\n} from '../common/utils';\r\n\r\nconst defaultColumWidth = 54; // 56pt = 72px\r\nconst defaultRowHeight = 15; // 15pt = 20px;\r\n\r\nconst rowComboWidth = 75;\r\n\r\nfunction* enumerateSel(sel) {\r\n\tif (!sel || !sel.length) return;\r\n\tfor (let sa of sel)\r\n\t\tfor (let r = sa.top; r < sa.bottom; r++)\r\n\t\t\tfor (let c = sa.left; c < sa.right; c++)\r\n\t\t\t\tyield `${toColRef(c)}${r + 1}`;\r\n}\r\n\r\nconst spreadsheetTemplate = `\r\n<div class=\"ss-container\" :class=\"{editable}\">\r\n\t<ss-toolbar v-if=\"editable\" />\r\n\t<div class=\"ss-body\" :key=updateCount ref=container tabindex=0 :style=bodyStyle\r\n\t\t@pointerup=pointerup @pointerdown=pointerdown @pointermove=pointermove\r\n\t\t@dblclick=dblclick @keydown.self.stop=keydown @wheel.prevent=mousewheel>\r\n\t\t<ss-canvas />\r\n\t\t<ss-rows-combo v-if=\"rowsCombo\" />\r\n\t\t<ss-cells />\r\n\t\t<ss-selection />\r\n\t\t<ss-edit v-if=editing text=editText />\r\n\t</div>\r\n\t<a2-scroll-bar class=\"no-me\" :horz=true :min=\"sheet.FixedColumns || 0\" :max=\"sheet.ColumnCount\"\r\n\t\t:pos=\"scrollPos.x\" :page=\"hScrollPageSize()\"\" :setPos=setPosX></a2-scroll-bar>\r\n\t<a2-scroll-bar class=\"no-me\" :horz=false :min=\"sheet.FixedRows || 0\" :max=\"sheet.RowCount\"\r\n\t\t:pos=\"scrollPos.y\" :page=\"vScrollPageSize()\" :setPos=setPosY></a2-scroll-bar>\r\n</div>\r\n`;\r\n\r\nVue.component('a2-spreadsheet', {\r\n\ttemplate: spreadsheetTemplate,\r\n\tcomponents: {\r\n\t\t'ss-canvas': spreadSheetCanvas,\r\n\t\t'ss-cells': spreadSheetCells,\r\n\t\t'ss-selection': spreadSheetSelection,\r\n\t\t'ss-edit': spreadSheetEdit,\r\n\t\t'ss-toolbar': spreadSheetToolbar\r\n\t},\r\n\tprops: {\r\n\t\treport: Object,\r\n\t\tgridLines: { type: Boolean, default: true },\r\n\t\theaders: { type: Boolean, default: true },\r\n\t\trowsCombo: Boolean,\r\n\t\teditable: { type: Boolean, default: true }\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tupdateCount: 0,\r\n\t\t\tscrollPos: { x: 0, y: 0 },\r\n\t\t\tediting: false,\r\n\t\t\tselecting: false,\r\n\t\t\teditRect: { l: 0, t: 0, w: 0, h: 0, c: '', r: -1 },\r\n\t\t\teditText: '',\r\n\t\t\tselStart: { c: 0, r: 0 },\r\n\t\t\tselection: []\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tsheet() {\r\n\t\t\treturn this.report.Workbook;\r\n\t\t},\r\n\t\tstartX() {\r\n\t\t\treturn rowHeaderWidth + (this.rowsCombo ? rowComboWidth : 0);\r\n\t\t},\r\n\t\tbodyStyle() {\r\n\t\t\tconsole.dir(this.sheet);\r\n\t\t\treturn { fontFamily: this.report.FontFamily, fontSize: `${this.sheet.FontSize}pt` };\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\trowFromPoint(pointY) {\r\n\t\t\tlet y = columnHeaderHeigth;\r\n\t\t\tfor (const r of this.renderedRows()) {\r\n\t\t\t\tlet rh = this.rowHeight(r);\r\n\t\t\t\tif (pointY >= y && pointY <= (y + rh))\r\n\t\t\t\t\treturn { row: r, top: y, height: rh };\r\n\t\t\t\ty += rh;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tcolFromPoint(pointX) {\r\n\t\t\tlet x = this.startX;\r\n\t\t\tfor (const c of this.renderedColumns()) {\r\n\t\t\t\tlet cw = this.colWidth(c);\r\n\t\t\t\tif (pointX >= x && pointX <= (x + cw))\r\n\t\t\t\t\treturn { col: c, left: x, width: cw };\r\n\t\t\t\tx += cw;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tcolWidth(c) {\r\n\t\t\tlet col = this.sheet.Columns[toColRef(c)];\r\n\t\t\tlet cw = this.sheet.ColumnWidth ?? defaultColumWidth;\r\n\t\t\tif (col && col.Width)\r\n\t\t\t\tcw = col.Width == -1 ? 70 : col.Width;\r\n\t\t\treturn pt2Px(cw);\r\n\t\t},\r\n\t\trowHeight(r) {\r\n\t\t\tlet row = this.sheet.Rows[r + 1];\r\n\t\t\tlet rh = this.sheet.RowHeight ?? defaultRowHeight;\r\n\t\t\tif (row && row.Height)\r\n\t\t\t\trh = row.Height;\r\n\t\t\treturn pt2Px(rh);\r\n\t\t},\r\n\t\tgetOrCreateRow(r) {\r\n\t\t\tlet row = this.sheet.Rows[r + 1];\r\n\t\t\tif (!row) {\r\n\t\t\t\trow = {};\r\n\t\t\t\tVue.set(this.sheet.Rows, r + 1, row);\r\n\t\t\t}\r\n\t\t\treturn row;\r\n\t\t},\r\n\t\tgetOrCreateColumn(c) {\r\n\t\t\tlet colRef = toColRef(c);\r\n\t\t\tlet col = this.sheet.Columns[colRef];\r\n\t\t\tif (!col) {\r\n\t\t\t\tcol = {};\r\n\t\t\t\tVue.set(this.sheet.Columns, colRef, col);\r\n\t\t\t}\r\n\t\t\treturn col;\r\n\t\t},\r\n\t\tselRect(s) {\r\n\t\t\tlet xc = s.left; let xr = s.top;\r\n\t\t\tlet y = columnHeaderHeigth;\r\n\t\t\tlet rect = { left: 0, top: 0, height: 0, width: 0 };\r\n\t\t\tfor (const r of this.renderedRows()) {\r\n\t\t\t\tlet rh = this.rowHeight(r);\r\n\t\t\t\tif (r === xr) {\r\n\t\t\t\t\trect.top = y; rect.height = rh;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse if (r > xr)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\ty += rh;\r\n\t\t\t}\r\n\t\t\tlet x = this.startX;\r\n\t\t\tfor (const c of this.renderedColumns()) {\r\n\t\t\t\tlet cw = this.colWidth(c);\r\n\t\t\t\tif (c === xc) {\r\n\t\t\t\t\trect.left = x, rect.width = cw;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse if (c > xc)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tx += cw;\r\n\t\t\t}\r\n\t\t\treturn rect;\r\n\t\t},\r\n\t\tpointFromEvent(ev) {\r\n\t\t\tlet cont = this.$refs.container;\r\n\t\t\tlet rect = cont.getBoundingClientRect();\r\n\t\t\tlet y = ev.clientY - rect.top;\r\n\t\t\tlet x = ev.clientX - rect.left;\r\n\t\t\treturn { x, y };\r\n\t\t},\r\n\t\tsetPosX(pos) {\r\n\t\t\tthis.scrollPos.x = pos;\r\n\t\t},\r\n\t\tsetPosY(pos) {\r\n\t\t\tthis.scrollPos.y = pos;\r\n\t\t},\r\n\t\trenderedRows: function* () {\r\n\t\t\tlet sh = this.sheet;\r\n\t\t\tfor (let f = 0; f < sh.FixedRows; f++)\r\n\t\t\t\tyield f;\r\n\t\t\tfor (let f = this.scrollPos.y; f < sh.RowCount; /* maxRows ??*/ f++)\r\n\t\t\t\tyield f;\r\n\t\t},\r\n\t\trenderedColumns: function* () {\r\n\t\t\tlet sh = this.sheet;\r\n\t\t\tfor (let c = 0; c < sh.FixedColumns; c++)\r\n\t\t\t\tyield c;\r\n\t\t\tfor (let c = this.scrollPos.x; c < sh.ColumnCount; /*maxColumns ?? */ c++)\r\n\t\t\t\tyield c;\r\n\t\t},\r\n\t\tsetPos(c, r) {\r\n\t\t\tlet sa = this.selection;\r\n\t\t\tif (!sa || !sa.length) return;\r\n\t\t\tlet sel = sa[0];\r\n\t\t\tlet sh = this.sheet;\r\n\t\t\tlet fix = sh.Fixed;\r\n\t\t\tif (c < 0) c = 0;\r\n\t\t\tif (c > sh.ColumnCount - 1) c = sh.ColumnCount - 1;\r\n\t\t\tif (r < 0) r = 0;\r\n\t\t\tif (r > sh.RowCount - 1) r = sh.RowCount - 1;\r\n\t\t\tsel.left = c; sel.right = c + 1;\r\n\t\t\tsel.top = r; sel.bottom = r + 1;\r\n\t\t\tthis.fitScrollPos();\r\n\t\t},\r\n\t\tmousewheel(ev) {\r\n\t\t\tlet deltaY = +(ev.deltaY / 100).toFixed();\r\n\t\t\tif (deltaY > 0)\r\n\t\t\t\tthis.scrollPos.y = Math.min(this.scrollPos.y + deltaY, this.sheet.RowCount - this.vScrollPageSize());\r\n\t\t\telse\r\n\t\t\t\tthis.scrollPos.y = Math.max(this.scrollPos.y + deltaY, (this.sheet.FixedRows || 0));\r\n\t\t},\r\n\t\tkeydown(ev) {\r\n\t\t\tlet sa = this.selection;\r\n\t\t\tif (!sa || !sa.length) return;\r\n\t\t\tlet sel = sa[0];\r\n\t\t\tswitch (ev.which) {\r\n\t\t\t\tcase 37: /* left */\r\n\t\t\t\t\tthis.setPos(sel.left - 1, sel.top);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 38: /* up */\r\n\t\t\t\t\tthis.setPos(sel.left, sel.top - 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 39: /* right */\r\n\t\t\t\t\tthis.setPos(sel.left + 1, sel.top);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 40: /* down */\r\n\t\t\t\t\tthis.setPos(sel.left, sel.top + 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 34: /* pgdn */\r\n\t\t\t\t\tthis.setPos(sel.left, sel.top + this.vScrollPageSize() + this.sheet.FixedRows /*TODO last visible row*/);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 33: /* pgup */\r\n\t\t\t\t\tthis.setPos(sel.left, sel.top - this.vScrollPageSize()/*TODO* first visible row*/);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 36: /* home */\r\n\t\t\t\t\tthis.setPos(0, sel.top);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 35: /* end */\r\n\t\t\t\t\tthis.setPos(this.sheet.Size.Columns - 1, sel.top);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 113: /* F2 */\r\n\t\t\t\t\tlet sr = this.selRect(sel);\r\n\t\t\t\t\tthis.doEdit({ col: sel.left, left: sr.left, width: sr.width },\r\n\t\t\t\t\t\t{ row: sel.top, top: sr.top, heigth: sr.height }\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.dir(ev.which);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\t\tfitSpan(cp, rp) {\r\n\t\t\tif (!cp || !rp) return;\r\n\t\t\tlet cellRef = `${toColRef(cp.col)}${rp.row + 1}`;\r\n\t\t\tlet cell = this.sheet.Cells[cellRef];\r\n\t\t\tif (cell) {\r\n\t\t\t\tif (cell.ColSpan > 1)\r\n\t\t\t\t\tfor (let c = 1; c < cell.ColSpan; c++)\r\n\t\t\t\t\t\tcp.width += this.colWidth(cp.col + c);\r\n\t\t\t\tif (cell.RowSpan > 1)\r\n\t\t\t\t\tfor (let r = 1; r < cell.RowSpan; r++)\r\n\t\t\t\t\t\trp.height += this.rowHeight(rp.row + r);\r\n\t\t\t}\r\n\t\t},\r\n\t\tdblclick(ev) {\r\n\t\t\tif (ev.srcElement.classList.contains('no-me'))\r\n\t\t\t\treturn;\r\n\t\t\tlet p = this.pointFromEvent(ev);\r\n\t\t\tlet cp = this.colFromPoint(p.x);\r\n\t\t\tlet rp = this.rowFromPoint(p.y);\r\n\t\t\tthis.fitSpan(cp, rp);\r\n\t\t\tthis.doEdit(cp, rp);\r\n\t\t},\r\n\t\tendEdit(val) {\r\n\t\t\tlet r = this.editRect;\r\n\t\t\tlet cellRef = `${toColRef(r.c)}${r.r + 1}`;\r\n\t\t\tlet cell = this.sheet.Cells[cellRef];\r\n\t\t\tif (!cell) {\r\n\t\t\t\tif (!val) return;\r\n\t\t\t\tcell = { Content: val }\r\n\t\t\t\tVue.set(this.sheet.Cells, cellRef, cell);\r\n\t\t\t}\r\n\t\t\tVue.set(cell, 'Value', val);\r\n\t\t},\r\n\t\tstartEdit(c, r) {\r\n\t\t\treturn { control: 'editor' };\r\n\t\t},\r\n\t\tcancelEdit() {\r\n\t\t\tthis.editing = false;\r\n\t\t\tthis.editText = '';\r\n\t\t},\r\n\t\tdoEdit(cp, rp) {\r\n\t\t\tif (!cp || !rp) return;\r\n\t\t\tlet res = this.startEdit(toColRef(cp.col), rp.row);\r\n\t\t\tif (!res)\r\n\t\t\t\treturn;\r\n\t\t\tlet er = this.editRect;\r\n\t\t\ter.l = cp.left;\r\n\t\t\ter.t = rp.top;\r\n\t\t\ter.w = cp.width;\r\n\t\t\ter.h = rp.height;\r\n\t\t\ter.c = cp.col;\r\n\t\t\ter.r = rp.row;\r\n\t\t\tlet c = this.sheet.Cells[`${toColRef(cp.col)}${rp.row + 1}`];\r\n\t\t\tif (c)\r\n\t\t\t\tthis.editText = c.Value;\r\n\t\t\telse\r\n\t\t\t\tthis.editText = '';\r\n\t\t\tthis.editing = true;\r\n\r\n\t\t},\r\n\t\t$selectCell(c, r, cell) {\r\n\t\t\tlet sht = this.sheet;\r\n\t\t\tlet sa = this.selection;\r\n\t\t\tthis.selecting = true;\r\n\t\t\tsa.length = 0;\r\n\t\t\tlet sp = { left: c, top: r, right: c + (cell.ColSpan || 1), bottom: r + (cell.RowSpan || 1) };\r\n\t\t\tsa.push(sp);\r\n\t\t},\r\n\t\tpointerdown(ev) {\r\n\t\t\tif (ev.srcElement.classList.contains('no-me'))\r\n\t\t\t\treturn;\r\n\t\t\tev.target.setPointerCapture(ev.pointerId);\r\n\t\t\tthis.cancelEdit();\r\n\t\t\tthis.selecting = true;\r\n\t\t\tlet sht = this.sheet;\r\n\t\t\tlet sa = this.selection;\r\n\t\t\tlet p = this.pointFromEvent(ev);\r\n\t\t\tif (p.x < this.startX) {\r\n\t\t\t\tlet rp = this.rowFromPoint(p.y);\r\n\t\t\t\tsa.length = 0;\r\n\t\t\t\tlet sp = { left: 0, top: rp.row, right: sht.ColumnCount, bottom: rp.row + 1 };\r\n\t\t\t\tsa.push(sp);\r\n\t\t\t}\r\n\t\t\telse if (p.y < columnHeaderHeigth) {\r\n\t\t\t\tlet cp = this.colFromPoint(p.x);\r\n\t\t\t\tsa.length = 0;\r\n\t\t\t\tlet sp = { left: cp.col, top: 0, right: cp.col + 1, bottom: sht.RowCount};\r\n\t\t\t\tsa.push(sp);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet sp = this.createSelRect(p.x, p.y);\r\n\t\t\t\tif (sp) {\r\n\t\t\t\t\tsa.length = 0;\r\n\t\t\t\t\tsa.push(sp);\r\n\t\t\t\t\tthis.selStart.x = sp.left;\r\n\t\t\t\t\tthis.selStart.y = sp.top;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tpointermove(ev) {\r\n\t\t\tif (!this.selecting) return;\r\n\t\t\tif (ev.srcElement.classList.contains('no-me'))\r\n\t\t\t\treturn;\r\n\t\t\tlet p = this.pointFromEvent(ev);\r\n\t\t\tlet sa = this.selection;\r\n\t\t\tif (!sa || !sa.length) return;\r\n\t\t\tlet sel = sa[0];\r\n\t\t\tif (p.x < this.startX) {\r\n\t\t\t\tlet rp = this.rowFromPoint(p.y);\r\n\t\t\t\tconsole.dir('select rows');\r\n\t\t\t}\r\n\t\t\telse if (p.y < columnHeaderHeigth) {\r\n\t\t\t\tlet cp = this.colFromPoint(p.x);\r\n\t\t\t\tconsole.dir('select columns');\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet sp = this.createSelRect(p.x, p.y);\r\n\t\t\t\tif (sp.left == this.selStart.x) {\r\n\t\t\t\t\tsel.left = sp.left;\r\n\t\t\t\t\tsel.right = sp.right;\r\n\t\t\t\t} if (sp.left < this.selStart.x)\r\n\t\t\t\t\tsel.left = sp.left;\r\n\t\t\t\telse\r\n\t\t\t\t\tsel.right = sp.right;\r\n\t\t\t\tif (sp.top == this.selStart.y) {\r\n\t\t\t\t\tsel.top = sp.top;\r\n\t\t\t\t\tsel.bottom = sp.bottom;\r\n\t\t\t\t} else if (sp.top < this.selStart.y)\r\n\t\t\t\t\tsel.top = sp.top;\r\n\t\t\t\telse\r\n\t\t\t\t\tsel.bottom = sp.bottom;\r\n\t\t\t\tthis.fitScrollPos();\r\n\t\t\t}\r\n\t\t},\r\n\t\tpointerup(ev) {\r\n\t\t\tev.target.releasePointerCapture(ev.pointerId);\r\n\t\t\tthis.selecting = false;\r\n\t\t\tthis.selStart.x = 0;\r\n\t\t\tthis.selStart.y = 0;\r\n\t\t\tthis.fitScrollPos();\r\n\t\t},\r\n\t\tfitScrollPos() {\r\n\t\t\tlet sa = this.selection;\r\n\t\t\tif (!sa || !sa.length) return;\r\n\t\t\tlet sel = sa[0];\r\n\t\t\tlet cont = this.$refs.container;\r\n\t\t\tlet cWidth = cont.clientWidth - 1; //- rowHeaderWidth;\r\n\t\t\tlet cHeight = cont.clientHeight - 1; //- columnHeaderHeigth;\r\n\t\t\tlet fix = { Rows: this.sheet.FixedRows || 0, Columns: this.sheet.FixedColumns|| 0 };\r\n\t\t\tlet sp = this.scrollPos;\r\n\t\t\tlet sr = null;\r\n\t\t\tif (sp.y > fix.Rows && sel.top < sp.y)\r\n\t\t\t\tsp.y = Math.max(sel.top, fix.Rows);\r\n\t\t\telse {\r\n\t\t\t\tsr = sr || this.selRect(sel);\r\n\t\t\t\tlet b = sr.top + sr.height + 1;\r\n\t\t\t\tif (b > cHeight)\r\n\t\t\t\t\tsp.y += 1;\r\n\t\t\t}\r\n\t\t\tif (sp.x > fix.Columns && sel.left < sp.x)\r\n\t\t\t\tsp.x = Math.max(sel.left, fix.Columns);\r\n\t\t\telse {\r\n\t\t\t\tsr = sr || this.selRect(sel);\r\n\t\t\t\tlet r = sr.left + sr.width + 1;\r\n\t\t\t\tif (r > cWidth)\r\n\t\t\t\t\tsp.x += 1;\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreateSelRect(x, y) {\r\n\t\t\tlet rp = this.rowFromPoint(y);\r\n\t\t\tlet cp = this.colFromPoint(x);\r\n\t\t\tif (cp && rp) {\r\n\t\t\t\tlet cellRef = `${toColRef(cp.col)}${rp.row + 1}`;\r\n\t\t\t\tlet cell = this.sheet.Cells[cellRef];\r\n\t\t\t\treturn { left: cp.col, top: rp.row, right: cp.col + 1 + (cell?.ColSpan - 1 || 0), bottom: rp.row + 1 + (cell?.RowSpan - 1 || 0) };\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tisInSelection(cb, cell) {\r\n\t\t\treturn this.selection.some(c => cb(c, this.sheet.Cells[`${toColRef(c.left)}${c.top + 1}`]));\r\n\t\t},\r\n\t\tcellClass(cell) {\r\n\t\t\tif (!cell) return '';\r\n\t\t\treturn this.__sp.cellClass(cell.Style);\r\n\t\t},\r\n\t\tcellStyle(cell) {\r\n\t\t\tif (!cell) return '';\r\n\t\t\treturn this.__sp.cellStyle(cell.Style);\r\n\t\t},\r\n\t\tcellStyle2(cell) {\r\n\t\t\tif (!cell) return '';\r\n\t\t\treturn this.__sp.cellStyle2(cell.Style);\r\n\t\t},\r\n\t\thScrollPageSize() {\r\n\t\t\tlet cont = this.$refs.container;\r\n\t\t\tif (!cont)\r\n\t\t\t\treturn 0;\r\n\t\t\tlet x = this.startX;\r\n\t\t\tlet max = cont.clientWidth;\r\n\t\t\tlet cols = 0;\r\n\t\t\tlet fc = this.sheet.FixedColumns || 0;\r\n\t\t\tfor (let c of this.renderedColumns()) {\r\n\t\t\t\tx += this.colWidth(c);\r\n\t\t\t\tif (x > max)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\telse if (c >= fc)\r\n\t\t\t\t\tcols += 1;\r\n\t\t\t}\r\n\t\t\treturn cols;\r\n\t\t},\r\n\t\tvScrollPageSize() {\r\n\t\t\tlet cont = this.$refs.container;\r\n\t\t\tif (!cont)\r\n\t\t\t\treturn 0;\r\n\t\t\tlet y = columnHeaderHeigth;\r\n\t\t\tlet max = cont.clientHeight;\r\n\t\t\tlet rows = 0;\r\n\t\t\tlet fr = this.sheet.FixedRows || 0;\r\n\t\t\tfor (let r of this.renderedRows()) {\r\n\t\t\t\ty += this.rowHeight(r);\r\n\t\t\t\tif (y > max)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\telse if (r >= fr)\r\n\t\t\t\t\trows += 1;\r\n\t\t\t}\r\n\t\t\treturn rows;\r\n\t\t},\r\n\t\t$getSelProp(prop) {\r\n\t\t\tlet sa = this.selection;\r\n\t\t\tif (!sa || !sa.length) return false;\r\n\t\t\tlet sel = sa[0];\r\n\t\t\tlet cellRef = `${toColRef(sel.left)}${sel.top+1}`;\r\n\t\t\tlet cell = this.sheet.Cells[cellRef];\r\n\t\t\tif (!cell || !cell.Style) return false;\r\n\t\t\tlet style = this.sheet.Styles[cell.Style];\r\n\t\t\tif (!style) return false;\r\n\t\t\treturn style[prop] || false;\r\n\t\t},\r\n\t\t$setSelProp(prop, val) {\r\n\t\t\tlet sel = this.selection;\r\n\t\t\tfor (let cr of enumerateSel(sel)) {\r\n\t\t\t\tlet cell = this.sheet.Cells[cr];\r\n\t\t\t\tif (!cell) {\r\n\t\t\t\t\tcell = { Value: val }\r\n\t\t\t\t\tVue.set(this.sheet.Cells, cr, cell);\r\n\t\t\t\t\tcell = this.sheet.Cells[cr];\r\n\t\t\t\t}\r\n\t\t\t\tVue.set(cell, 'Style', this.__sp.setStyleProp(cell.Style, prop, val));\r\n\t\t\t\t/*\r\n\t\t\t\tconsole.dir(cell.Style);\r\n\t\t\t\tthis.__sp.findStyle(cell.Style);\r\n\t\t\t\tconsole.dir(styleHashCode(cell.Style));\r\n\t\t\t\t*/\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\tmounted() {\r\n\t\tthis.updateCount += 1;\r\n\t\tlet sp = { left: 0, top: 0, right: 1, bottom: 1 };\r\n\t\t// TODO: check span\r\n\t\tthis.selection.push(sp);\r\n\t\tthis.scrollPos.x = this.sheet.FixedColumns || 0;\r\n\t\tthis.scrollPos.y = this.sheet.FixedRows || 0;\r\n\t\tthis.__ro = new ResizeObserver(x => {\r\n\t\t\tthis.updateCount += 1;\r\n\t\t\tthis.fitScrollPos();\r\n\t\t});\r\n\t\tthis.__ro.observe(this.$el);\r\n\t\tthis.__sp = new StyleProcessor(this.sheet.Styles);\r\n\t\tthis.__mergeCells = {};\r\n\t\tfor (let cr in this.sheet.Cells) {\r\n\t\t\tlet cell = this.sheet.Cells[cr];\r\n\t\t\tif (cell.ColSpan > 1 || cell.RowSpan > 1) {\r\n\t\t\t\tlet rowCol = fromCellRef(cr);\r\n\t\t\t\tif (cell.RowSpan > 1 && (cell.ColSpan || 1) == 1)\r\n\t\t\t\t\tfor (let r = 1; r < (cell.RowSpan || 1); r++)\r\n\t\t\t\t\t\tthis.__mergeCells[`${toColRef(rowCol.c)}${r + rowCol.r}`] = cr;\r\n\t\t\t\telse if (cell.ColSpan > 1 && (cell.RowSpan || 1) == 1)\r\n\t\t\t\t\tfor (let c = 1; c < (cell.ColSpan || 1); c++)\r\n\t\t\t\t\t\tthis.__mergeCells[`${toColRef(c + rowCol.c)}${rowCol.r}`] = cr;\r\n\t\t\t\telse\r\n\t\t\t\t\tfor (let c = 1; c < (cell.ColSpan || 1); c++)\r\n\t\t\t\t\t\tfor (let r = 1; r < (cell.RowSpan || 1); r++)\r\n\t\t\t\t\t\t\tthis.__mergeCells[`${toColRef(c + rowCol.c)}${r + rowCol.r}`] = cr;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// TODO: auto style\r\n\t\tthis.sheet.ColumnCount = Math.max(this.sheet.ColumnCount, 26);\r\n\t\tthis.sheet.RowCount = Math.max(this.sheet.RowCount, 100);\r\n\t},\r\n\tbeforeDestroy() {\r\n\t\tif (this.__ro)\r\n\t\t\tthis.__ro.unobserve(this.$el);\r\n\t}\r\n});"],"names":["toColRef","n","String","fromCharCode","Math","floor","toPx","columnHeaderHeigth","fromCellRef","ref","match","Error","c","rn","parseInt","cn","i","length","charCodeAt","r","pt2Px","p","round","px2Pt","px","StyleProcessor","constructor","styles","this","stylesMap","Object","keys","reduce","st","styleHashCode","defaultStyle","Bold","Italic","FontSize","Align","VAlign","Border","BackgroundColor","Background","cellClass","key","toLowerCase","cellStyle","setBorder","name","val","fontSize","FontName","fontFamily","console","dir","bx","split","border","backgroundColor","cellStyle2","appendNewStyle","styleObj","hashCode","skey","obj","hasOwnProperty","getNextKey","Vue","set","setStyleProp","prop","sobj","assign","shc","component","template","props","horz","Boolean","page","Number","pos","min","max","setPos","Function","data","tempClientSize","moving","delta","thumbMovePos","computed","sbClass","thumbPos","size","clientSize","s","$refs","body","clientWidth","clientHeight","thumbSize","sz","thumbStyle","left","width","top","height","decDisabled","incDisabled","decLabel","incLabel","methods","dec","setPosCheck","inc","np","clickBody","ev","offsetX","offsetY","thumbDown","target","setPointerCapture","pointerId","hors","thumbMove","rect","getBoundingClientRect","tpos","clientX","clientY","ths","maxPos","thumbUp","releasePointerCapture","step","toFixed","mounted","spreadSheetCanvas","rType","rItem","rPt","rSize","clearData","onUp","cb","stopPropagation","ns","hMouseDown","ep","$parent","pointFromEvent","col","colFromPoint","x","hMouseUp","nw","cw","getOrCreateColumn","hMouseMove","vMouseDown","row","rowFromPoint","y","vMouseUp","nh","getOrCreateRow","vMouseMove","render","h","parent","sh","sheet","cont","container","maxWidth","maxHeigth","elems","self","startX","right","bottom","headers","push","class","renderedColumns","colRef","colWidth","cls","isInSelection","sel","cell","ColSpan","ColumnCount","style","on","pointerdown","pointerup","pointermove","topHeader","renderedRows","rh","rowHeight","RowSpan","RowCount","leftHeader","gridLines","FixedColumns","vLines","FixedRows","hLines","spreadSheetCells","cellRef","Cells","cellCls","sc","sr","clickPh","Value","preventDefault","$selectCell","spreadSheetSelection","selection","ch","selRect","cx","rx","spreadSheetEdit","blur","endEdit","innerText","editRect","l","t","w","domProps","contentEditable","editText","$el","focus","spellcheck","spreadSheetToolbar","isChecked","$getSelProp","isCheckedProp","toggleBool","$setSelProp","setProp","components","report","type","default","rowsCombo","editable","updateCount","scrollPos","editing","selecting","selStart","Workbook","bodyStyle","FontFamily","pointY","pointX","Columns","ColumnWidth","Width","Rows","RowHeight","Height","xc","xr","setPosX","setPosY","f","sa","Fixed","fitScrollPos","mousewheel","deltaY","vScrollPageSize","keydown","which","Size","doEdit","heigth","fitSpan","cp","rp","dblclick","srcElement","classList","contains","Content","startEdit","control","cancelEdit","er","sp","sht","createSelRect","cWidth","cHeight","fix","some","__sp","Style","hScrollPageSize","cols","fc","rows","fr","Styles","cr","enumerateSel","__ro","ResizeObserver","observe","__mergeCells","rowCol","beforeDestroy","unobserve"],"mappings":"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"}