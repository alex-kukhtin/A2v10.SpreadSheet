{"version":3,"file":"a2v10spreadsheet.min.js","sources":["../../src/components/common/utils.js","../../src/components/common/scrollbar.js","../../src/components/ssheet/canvas.js","../../src/components/ssheet/cell.js","../../src/components/ssheet/cells.js","../../src/components/ssheet/selection.js","../../src/components/ssheet/edit.js","../../src/components/ssheet/toolbar.js","../../src/components/ssheet/spreadsheet.js"],"sourcesContent":["\r\nexport const toColRef = (n) => n >= 26 ? String.fromCharCode(Math.floor(n / 26) + 64) + String.fromCharCode(n % 26 + 65) : String.fromCharCode(n + 65);\r\nexport const toPx = (n) => n + 'px';\r\n\r\nexport const rowHeaderWidth = 32;\r\nexport const columnHeaderHeigth = 23; // column header height - 1\r\n\r\n\r\n\r\n","\r\nimport { toPx } from './utils';\r\n\r\nVue.component('a2-scroll-bar', {\r\n\ttemplate: `\r\n<div class=\"a2-sb\" :class=\"sbClass\">\r\n\t<button @click.stop=dec :disabled=decDisabled v-text=decLabel></button>\r\n\t<div class=\"sb-body\" @click.self=\"clickBody\" ref=body>\r\n\t\t<div class=\"thumb\" @pointerdown.self.stop=thumbDown\r\n\t\t\t@pointerup.self.stop=thumbUp @pointermove.self.stop=thumbMove\r\n\t\t\t:style=thumbStyle :class=\"{horz: horz, vert: !horz }\"></div>\r\n\t</div>\r\n\t<button @click.stop=inc :disabled=incDisabled v-text=incLabel></button>\r\n</div>\r\n`,\r\n\tprops: {\r\n\t\thorz: Boolean,\r\n\t\tpage: Number,\r\n\t\tpos: Number,\r\n\t\tmin: Number,\r\n\t\tmax: Number,\r\n\t\tsetPos: Function\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\ttempClientSize: 0,\r\n\t\t\tmoving: false,\r\n\t\t\tdelta: 0,\r\n\t\t\tthumbMovePos: 0\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tsbClass() {\r\n\t\t\treturn this.horz ? 'horz' : 'vert';\r\n\t\t},\r\n\t\tthumbPos() {\r\n\t\t\tif (this.moving)\r\n\t\t\t\treturn this.thumbMovePos;\r\n\t\t\tlet step = (this.clientSize) / (this.size);\r\n\t\t\treturn step * (this.pos - this.min);\r\n\t\t},\r\n\t\tsize() {\r\n\t\t\treturn this.max - this.min;\r\n\t\t},\r\n\t\tclientSize() {\r\n\t\t\tlet s = this.tempClientSize;\r\n\t\t\tif (this.$refs.body)\r\n\t\t\t\ts = (this.horz ? this.$refs.body.clientWidth : this.$refs.body.clientHeight);\r\n\t\t\treturn s;\r\n\t\t},\r\n\t\tthumbSize() {\r\n\t\t\tlet sz = this.clientSize;\r\n\t\t\treturn this.page * sz / this.size;\r\n\t\t},\r\n\t\tthumbStyle() {\r\n\t\t\tif (this.horz)\r\n\t\t\t\treturn { left: toPx(this.thumbPos), width: toPx(this.thumbSize) };\r\n\t\t\telse\r\n\t\t\t\treturn { top: toPx(this.thumbPos), height: toPx(this.thumbSize) };\r\n\t\t},\r\n\t\tdecDisabled() {\r\n\t\t\treturn this.pos <= this.min;\r\n\t\t},\r\n\t\tincDisabled() {\r\n\t\t\treturn this.pos >= this.max - this.page;\r\n\t\t},\r\n\t\tdecLabel() { return this.horz ? '◂' : '▴'; },\r\n\t\tincLabel() { return this.horz ? '▸' : '▾'; }\r\n\t},\r\n\tmethods: {\r\n\t\tdec() {\r\n\t\t\tthis.setPosCheck(this.pos - 1);\r\n\t\t},\r\n\t\tinc() {\r\n\t\t\tthis.setPosCheck(this.pos + 1);\r\n\t\t},\r\n\t\tsetPosCheck(np) {\r\n\t\t\tif (np < this.min)\r\n\t\t\t\tnp = this.min;\r\n\t\t\tif (np > this.max - this.page)\r\n\t\t\t\tnp = this.max - this.page;\r\n\t\t\tthis.setPos(np);\r\n\t\t},\r\n\t\tclickBody(ev) {\r\n\t\t\tlet dx = this.horz ? ev.offsetX : ev.offsetY;\r\n\t\t\tlet np = 0;\r\n\t\t\tif (dx < this.thumbPos)\r\n\t\t\t\tnp = this.pos - this.page;\r\n\t\t\telse\r\n\t\t\t\tnp = this.pos + this.page;\r\n\t\t\tthis.setPosCheck(np);\r\n\t\t},\r\n\t\tthumbDown(ev) {\r\n\t\t\tev.target.setPointerCapture(ev.pointerId);\r\n\t\t\tthis.delta = this.hors ? ev.offsetX : ev.offsetY;\r\n\t\t\tthis.thumbMovePos = this.thumbPos;\r\n\t\t\tthis.moving = true;\r\n\t\t},\r\n\t\tthumbMove(ev) {\r\n\t\t\tif (!this.moving) return;\r\n\t\t\tlet rect = this.$refs.body.getBoundingClientRect();\r\n\t\t\tlet tpos = this.horz ? ev.clientX - this.delta - rect.left : ev.clientY - this.delta - rect.top;\r\n\t\t\tif (tpos < 0) tpos = 0;\r\n\t\t\tlet ths = this.thumbSize;\r\n\t\t\tlet maxPos = this.horz ? rect.width - ths : rect.height - ths;\r\n\t\t\tif (tpos > maxPos) tpos = maxPos;\r\n\t\t\tthis.thumbMovePos = tpos;\r\n\t\t},\r\n\t\tthumbUp(ev) {\r\n\t\t\tev.target.releasePointerCapture(ev.pointerId);\r\n\t\t\tlet pos = this.thumbMovePos;\r\n\t\t\tthis.moving = false;\r\n\t\t\tlet step = this.clientSize / (this.max - this.min);\r\n\t\t\tlet np = Math.min(+ (pos / step).toFixed(), this.max - this.page);\r\n\t\t\tthis.setPosCheck(np + this.min);\r\n\t\t}\r\n\t},\r\n\tmounted() {\r\n\t\tthis.tempClientSize = (this.horz ? this.$refs.body.clientWidth : this.$refs.body.clientHeight);\r\n\t}\r\n});","\r\nimport { toColRef, toPx, rowHeaderWidth, columnHeaderHeigth } from '../common/utils';\r\n\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\trType: '',\r\n\t\t\trItem: -1,\r\n\t\t\trPt: -1,\r\n\t\t\trSize: -1,\r\n\t\t\tdelta: 0,\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tclearData() {\r\n\t\t\tthis.rType = '';\r\n\t\t\tthis.rItem = -1;\r\n\t\t\tthis.rSize = 0;\r\n\t\t\tthis.rPt = 0;\r\n\t\t\tthis.delta = 0;\r\n\t\t},\r\n\t\tonUp(ev, cb) {\r\n\t\t\tev.target.releasePointerCapture(ev.pointerId);\r\n\t\t\tev.stopPropagation();\r\n\t\t\tif (this.rItem < 0)\r\n\t\t\t\treturn;\r\n\t\t\tlet ns = this.rPt - this.rSize;\r\n\t\t\tif (ns < 5)\r\n\t\t\t\tns = 5;\r\n\t\t\tcb(ns)\r\n\t\t\tthis.clearData();\r\n\t\t},\r\n\t\thMouseDown(ev) {\r\n\t\t\tev.stopPropagation();\r\n\t\t\tlet ep = this.$parent.pointFromEvent(ev);\r\n\t\t\tlet col = this.$parent.colFromPoint(ep.x);\r\n\t\t\tif (!col) return;\r\n\t\t\tev.target.setPointerCapture(ev.pointerId);\r\n\t\t\tthis.rType = 'C';\r\n\t\t\tthis.rItem = col.col;\r\n\t\t\tthis.rPt = col.left + col.width;\r\n\t\t\tthis.rSize = col.left;\r\n\t\t\tthis.delta = this.rPt - ev.clientX;\r\n\t\t},\r\n\t\thMouseUp(ev) {\r\n\t\t\tthis.onUp(ev, nw => {\r\n\t\t\t\tlet col = this.$parent.getOrCreateColumn(this.rItem);\r\n\t\t\t\tVue.set(col, 'Width', nw);\r\n\t\t\t});\r\n\t\t},\r\n\t\thMouseMove(ev) {\r\n\t\t\tif (this.rItem < 0)\r\n\t\t\t\treturn;\r\n\t\t\tthis.rPt = ev.clientX + this.delta;\r\n\t\t},\r\n\t\tvMouseDown(ev) {\r\n\t\t\tev.stopPropagation();\r\n\t\t\tlet ep = this.$parent.pointFromEvent(ev);\r\n\t\t\tlet row = this.$parent.rowFromPoint(ep.y);\r\n\t\t\tif (!row) return;\r\n\t\t\tev.target.setPointerCapture(ev.pointerId);\r\n\t\t\tthis.rType = 'R';\r\n\t\t\tthis.rItem = row.row;\r\n\t\t\tthis.rPt = row.top + row.height;\r\n\t\t\tthis.rSize = row.top;\r\n\t\t\tthis.delta = this.rPt - ev.clientY;\r\n\t\t},\r\n\t\tvMouseUp(ev) {\r\n\t\t\tthis.onUp(ev, nh => {\r\n\t\t\t\tlet row = this.$parent.getOrCreateRow(this.rItem);\r\n\t\t\t\tVue.set(row, 'Height', nh);\r\n\t\t\t});\r\n\t\t},\r\n\t\tvMouseMove(ev) {\r\n\t\t\tif (this.rItem < 0)\r\n\t\t\t\treturn;\r\n\t\t\tthis.rPt = ev.clientY + this.delta;\r\n\t\t},\r\n\t},\r\n\trender(h) {\r\n\t\tlet parent = this.$parent;\r\n\t\tlet sh = parent.sheet;\r\n\t\tlet cont = parent.$refs.container;\r\n\t\tif (!cont)\r\n\t\t\treturn;\r\n\t\tlet maxWidth = cont.clientWidth;\r\n\t\tlet maxHeigth = cont.clientHeight;\r\n\t\tlet elems = [];\r\n\t\tlet self = this;\r\n\t\tlet startX = parent.startX;\r\n\r\n\t\tlet maxPos = { right: 0, bottom: 0 };\r\n\r\n\t\tfunction vLines() {\r\n\t\t\tlet x = startX; // row header width\r\n\t\t\tfor (const c of parent.renderedColumns()) {\r\n\t\t\t\tx += parent.colWidth(c);\r\n\t\t\t\tif (x >= maxWidth)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tlet cls = 'vline';\r\n\t\t\t\tif (c == sh.Fixed.Columns - 1)\r\n\t\t\t\t\tcls += ' freeze';\r\n\t\t\t\telems.push(h('div', { class: cls, style: { left: toPx(x), height: toPx(maxPos.bottom) } }));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction hLines() {\r\n\t\t\tlet y = columnHeaderHeigth;\r\n\t\t\tfor (const r of parent.renderedRows()) {\r\n\t\t\t\tlet rh = parent.rowHeight(r);\r\n\t\t\t\ty += rh;\r\n\t\t\t\tif (y >= maxHeigth)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tlet cls = 'hline';\r\n\t\t\t\tif (r === sh.Fixed.Rows - 1)\r\n\t\t\t\t\tcls += ' freeze';\r\n\t\t\t\telems.push(h('div', { class: cls, style: { top: toPx(y), width: toPx(maxPos.right) } }));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction topHeader() {\r\n\t\t\tlet x = startX; // row header width\r\n\t\t\tfor (const c of parent.renderedColumns()) {\r\n\t\t\t\tlet colRef = toColRef(c);\r\n\t\t\t\tlet cw = parent.colWidth(c);\r\n\t\t\t\tlet cls = 'thc';\r\n\t\t\t\tif (parent.isInSelection((sel, cell) => c >= sel.left && c <= sel.left + (cell?.ColSpan - 1 || 0)))\r\n\t\t\t\t\tcls += ' thc-sel';\r\n\t\t\t\tif (c === sh.Size.Columns - 1) {\r\n\t\t\t\t\tcls += ' last';\r\n\t\t\t\t\tcw += 1;\r\n\t\t\t\t}\r\n\t\t\t\telems.push(h('div', { class: cls, style: { width: toPx(cw), left: toPx(x) } }, [colRef,\r\n\t\t\t\t\th('div', {\r\n\t\t\t\t\t\tclass: 'h-size no-me',\r\n\t\t\t\t\t\ton: { pointerdown: self.hMouseDown, pointerup: self.hMouseUp, pointermove: self.hMouseMove }\r\n\t\t\t\t\t})]));\r\n\t\t\t\tx += cw;\r\n\t\t\t\tif (x >= maxWidth)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tmaxPos.right = x - rowHeaderWidth - 1; /* without combo! */\r\n\t\t}\r\n\r\n\t\tfunction leftHeader() {\r\n\t\t\tlet y = columnHeaderHeigth;\r\n\t\t\tfor (const r of parent.renderedRows()) {\r\n\t\t\t\tlet rh = parent.rowHeight(r);\r\n\t\t\t\tlet cls = 'thr'\r\n\t\t\t\tif (parent.isInSelection((sel, cell) => r >= sel.top && r <= sel.top + (cell?.RowSpan - 1 || 0)))\r\n\t\t\t\t\tcls += ' thr-sel'\r\n\t\t\t\tif (r === sh.Size.Rows - 1) {\r\n\t\t\t\t\tcls += ' last';\r\n\t\t\t\t\trh += 1;\r\n\t\t\t\t}\r\n\t\t\t\telems.push(h('div', { class: cls, style: { height: toPx(rh), top: toPx(y) } }, ['' + (r + 1),\r\n\t\t\t\th('div', {\r\n\t\t\t\t\tclass: 'v-size no-me',\r\n\t\t\t\t\ton: { pointerdown: self.vMouseDown, pointerup: self.vMouseUp, pointermove: self.vMouseMove }\r\n\t\t\t\t})]));\r\n\t\t\t\ty += rh;\r\n\t\t\t\tif (y >= maxHeigth) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tmaxPos.bottom = y - columnHeaderHeigth - 1;\r\n\t\t}\r\n\r\n\t\tif (parent.headers) {\r\n\t\t\telems.push(h('div', { class: 'r-top' }));\r\n\t\t\ttopHeader();\r\n\t\t\tleftHeader();\r\n\t\t} else if (parent.gridLines) {\r\n\t\t\tconsole.dir('calc maxPos')\r\n\t\t}\r\n\r\n\t\tif (parent.gridLines) {\r\n\t\t\tvLines();\r\n\t\t\thLines();\r\n\t\t}\r\n\r\n\t\tif (this.rItem >= 0) {\r\n\t\t\tif (this.rType == 'C')\r\n\t\t\t\telems.push(h('div', { class: 'h-resize-line', style: { left: toPx(this.rPt) } }));\r\n\t\t\telse\r\n\t\t\t\telems.push(h('div', { class: 'v-resize-line', style: { top: toPx(this.rPt) } }));\r\n\t\t}\r\n\r\n\r\n\t\treturn h('div', { class: 'canvas' }, elems);\r\n\t}\r\n};\r\n","\r\nimport { toColRef } from '../common/utils';\r\n\r\nexport default {\r\n\trender(h) {\r\n\t\tlet p = this.$parent;\r\n\t\tlet sh = p.sheet;\r\n\t\tlet cont = p.$refs.container;\r\n\t\tif (!cont)\r\n\t\t\treturn;\r\n\t\tlet maxWidth = cont.clientWidth;\r\n\t\tlet maxHeigth = cont.clientHeight;\r\n\t\tlet elems = [];\r\n\t\tlet y = columnHeaderHeigth;\r\n\t\tconst startX = p.startX;\r\n\t\tfor (const r of p.renderedRows()) {\r\n\t\t\tlet x = startX;\r\n\t\t\tlet rh = this.$parent.rowHeight(r);\r\n\t\t\tfor (const c of p.renderedColumns()) {\r\n\t\t\t\tlet colRef = toColRef(c)\r\n\t\t\t\tlet cw = p.colWidth(c);\r\n\t\t\t\tconst cellRef = `${colRef}${r + 1}`;\r\n\t\t\t\tlet cell = sh.Cells[cellRef];\r\n\t\t\t\tif (cell) {\r\n\t\t\t\t\tif (cell.ColSpan > 1 || cell.RowSpan > 1) {\r\n\t\t\t\t\t\tlet nw = cw;\r\n\t\t\t\t\t\tlet nh = rh;\r\n\t\t\t\t\t\tfor (let sc = 1; sc < cell.ColSpan; sc++)\r\n\t\t\t\t\t\t\tnw += p.colWidth(sc + c);\r\n\t\t\t\t\t\tfor (let sr = 1; sr < cell.RowSpan; sr++)\r\n\t\t\t\t\t\t\tnh += p.rowHeight(sr + r);\r\n\t\t\t\t\t\telems.push(h('div', {\r\n\t\t\t\t\t\t\tclass: 'cell-ph',\r\n\t\t\t\t\t\t\tstyle: { left: toPx(x + 1), top: toPx(y + 1), width: toPx(nw - 1), height: toPx(nh - 1) }\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet cellCls = 'cell' + p.cellClass(cell);\r\n\t\t\t\t\telems.push(h('div', {\r\n\t\t\t\t\t\tclass: cellCls,\r\n\t\t\t\t\t\tstyle: { left: toPx(x), top: toPx(y), width: toPx(cw + 1), height: toPx(rh + 1) }\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\tcell.Content));\r\n\t\t\t\t}\r\n\t\t\t\tx += cw;\r\n\t\t\t\tif (x >= maxWidth)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\ty += rh;\r\n\t\t\tif (y >= maxHeigth)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn h('div', { class: 'cells' }, elems);\r\n\t}\r\n}\r\n","\r\nimport { columnHeaderHeigth, toColRef, toPx } from '../common/utils';\r\n\r\nexport default {\r\n\trender(h) {\r\n\t\tlet p = this.$parent;\r\n\t\tlet sh = p.sheet;\r\n\t\tlet cont = p.$refs.container;\r\n\t\tif (!cont)\r\n\t\t\treturn;\r\n\t\tlet maxWidth = cont.clientWidth;\r\n\t\tlet maxHeigth = cont.clientHeight;\r\n\t\tlet elems = [];\r\n\t\tlet y = columnHeaderHeigth;\r\n\t\tconst startX = p.startX;\r\n\t\tfor (const r of p.renderedRows()) {\r\n\t\t\tlet x = startX;\r\n\t\t\tlet rh = this.$parent.rowHeight(r);\r\n\t\t\tfor (const c of p.renderedColumns()) {\r\n\t\t\t\tlet colRef = toColRef(c)\r\n\t\t\t\tlet cw = p.colWidth(c);\r\n\t\t\t\tconst cellRef = `${colRef}${r + 1}`;\r\n\t\t\t\tlet cell = sh.Cells[cellRef];\r\n\t\t\t\tif (cell) {\r\n\t\t\t\t\tif (cell.ColSpan > 1 || cell.RowSpan > 1) {\r\n\t\t\t\t\t\tlet nw = cw;\r\n\t\t\t\t\t\tlet nh = rh;\r\n\t\t\t\t\t\tfor (let sc = 1; sc < cell.ColSpan; sc++)\r\n\t\t\t\t\t\t\tnw += p.colWidth(sc + c);\r\n\t\t\t\t\t\tfor (let sr = 1; sr < cell.RowSpan; sr++)\r\n\t\t\t\t\t\t\tnh += p.rowHeight(sr + r);\r\n\t\t\t\t\t\telems.push(h('div', {\r\n\t\t\t\t\t\t\tclass: 'cell-ph',\r\n\t\t\t\t\t\t\tstyle: { left: toPx(x + 1), top: toPx(y + 1), width: toPx(nw - 1), height: toPx(nh - 1) }\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet cellCls = 'cell' + p.cellClass(cell);\r\n\t\t\t\t\telems.push(h('div', {\r\n\t\t\t\t\t\tclass: cellCls,\r\n\t\t\t\t\t\tstyle: { left: toPx(x), top: toPx(y), width: toPx(cw + 1), height: toPx(rh + 1) }\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\tcell.Content));\r\n\t\t\t\t}\r\n\t\t\t\tx += cw;\r\n\t\t\t\tif (x >= maxWidth)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\ty += rh;\r\n\t\t\tif (y >= maxHeigth)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn h('div', { class: 'cells' }, elems);\r\n\t}\r\n}\r\n","\r\nimport { toPx } from '../common/utils';\r\n\r\nexport default {\r\n\trender(h) {\r\n\t\tlet sel = this.$parent.sheet.$selection;\r\n\t\tlet ch = [];\r\n\t\tfor (let i = 0; i < sel.length; i++) {\r\n\t\t\tlet s = sel[i];\r\n\t\t\tlet r = this.$parent.selRect(s);\r\n\t\t\tif (r && r.left >= 0 && r.top >= 0) {\r\n\t\t\t\tfor (let cx = s.left + 1; cx < s.right; cx++)\r\n\t\t\t\t\tr.width += this.$parent.colWidth(cx);\r\n\t\t\t\tfor (let rx = s.top + 1; rx < s.bottom; rx++)\r\n\t\t\t\t\tr.height += this.$parent.rowHeight(rx);\r\n\t\t\t\tlet cls = 'sel';\r\n\t\t\t\tif (s.bottom > s.top + 1 || s.right > s.left + 1)\r\n\t\t\t\t\tcls += ' multiply';\r\n\t\t\t\tch.push(h('div', { class: cls, style: { left: toPx(r.left), top: toPx(r.top), width: toPx(r.width + 1), height: toPx(r.height + 1) } }));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn h('div', { class: 'selections' }, ch);\r\n\t}\r\n}\r\n","\r\nimport { toPx, toColRef } from '../common/utils';\r\n\r\nexport default {\r\n\tmethods: {\r\n\t\tblur(ev) {\r\n\t\t\tlet p = this.$parent;\r\n\t\t\tp.endEdit(ev.target.innerText);\r\n\t\t}\r\n\t},\r\n\trender(h) {\r\n\t\tlet p = this.$parent;\r\n\t\tlet r = p.editRect;\r\n\t\tlet cellRef = `${toColRef(r.c)}${r.r + 1}`;\r\n\t\tlet cell = p.sheet.Cells[cellRef];\r\n\t\treturn h('div', {\r\n\t\t\tclass: 'input cell-edit no-me' + p.cellClass(cell),\r\n\t\t\tstyle: { left: toPx(r.l + 1), top: toPx(r.t + 1), width: toPx(r.w - 1), height: toPx(r.h - 1) },\r\n\t\t\tdomProps: { contentEditable: true },\r\n\t\t\ton: { blur: this.blur }\r\n\t\t}, p.editText);\r\n\t},\r\n\tmounted() {\r\n\t\tthis.$el.focus();\r\n\t}\r\n}\r\n","\r\nconst toolbarTemplate = `\r\n<div class=\"ss-toolbar\">TOOLBAR\r\n\t<button @click=\"forAll('Bold')\">B</button>\r\n\t<button @click=\"forAll('Italic')\">I</button>\r\n</div>\r\n`;\r\nexport default {\r\n\ttemplate: toolbarTemplate,\r\n\tprops: {\r\n\t},\r\n\tmethods: {\r\n\t\tforAll(prop) {\r\n\t\t\tlet sheet = this.$parent.sheet;\r\n\t\t\tlet sel = sheet.$selection;\r\n\t\t\tif (!sel.length) return;\r\n\t\t\tlet set = true;\r\n\t\t\tlet create = true;\r\n\t\t\tfor (let sr of sel) {\r\n\t\t\t\tfor (let r = sr.top; r < sr.bottom; r++) {\r\n\t\t\t\t\tfor (let c = sr.left; c < sr.right; c++) {\r\n\t\t\t\t\t\tthis.$parent.setProp(c, r, (cell) => Vue.set(cell, prop, set), create)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","\r\nimport spreadSheetCanvas from './canvas';\r\nimport spreadSheetCell from './cell';\r\nimport spreadSheetCells from './cells';\r\nimport spreadSheetSelection from './selection';\r\nimport spreadSheetEdit from './edit';\r\nimport spreadSheetToolbar from './toolbar';\r\n\r\nimport { toColRef, rowHeaderWidth, columnHeaderHeigth } from '../common/utils';\r\n\r\nconst defaultColumWidth = 100;\r\nconst defaultRowHeight = 23;\r\n\r\nconst rowComboWidth = 75;\r\n\r\nconst spreadsheetTemplate = `\r\n<div class=\"ss-container\" :class=\"{editable}\">\r\n\t<ss-toolbar v-if=\"editable\" />\r\n\t<div class=\"ss-body\" :key=updateCount ref=container tabindex=0\r\n\t\t@pointerup=pointerup @pointerdown=pointerdown @pointermove=pointermove\r\n\t\t@dblclick=dblclick @keydown.self.stop.prevent=keydown @wheel.prevent=mousewheel>\r\n\t\t<ss-canvas />\r\n\t\t<ss-rows-combo v-if=\"rowsCombo\" />\r\n\t\t<ss-cells />\r\n\t\t<ss-selection />\r\n\t\t<ss-edit v-if=editing text=editText />\r\n\t</div>\r\n\t<a2-scroll-bar class=\"no-me\" :horz=true :min=\"sheet.Fixed.Columns\" :max=\"sheet.Size.Columns\"\r\n\t\t:pos=\"scrollPos.x\" :page=\"hScrollPageSize()\"\" :setPos=setPosX></a2-scroll-bar>\r\n\t<a2-scroll-bar class=\"no-me\" :horz=false :min=\"sheet.Fixed.Rows\" :max=\"sheet.Size.Rows\"\r\n\t\t:pos=\"scrollPos.y\" :page=\"vScrollPageSize()\" :setPos=setPosY></a2-scroll-bar>\r\n</div>\r\n`;\r\n\r\nVue.component('a2-spreadsheet', {\r\n\ttemplate: spreadsheetTemplate,\r\n\tcomponents: {\r\n\t\t'ss-canvas': spreadSheetCanvas,\r\n\t\t'ss-cell': spreadSheetCell,\r\n\t\t'ss-cells': spreadSheetCells,\r\n\t\t'ss-selection': spreadSheetSelection,\r\n\t\t'ss-edit': spreadSheetEdit,\r\n\t\t'ss-toolbar': spreadSheetToolbar\r\n\t},\r\n\tprops: {\r\n\t\tsheet: Object,\r\n\t\tgridLines: { type: Boolean, default: true },\r\n\t\theaders: { type: Boolean, default: true },\r\n\t\trowsCombo: Boolean,\r\n\t\teditable: { type: Boolean, default: true }\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tupdateCount: 0,\r\n\t\t\tscrollPos: { x: 0, y: 0 },\r\n\t\t\tediting: false,\r\n\t\t\tselecting: false,\r\n\t\t\teditRect: { l: 0, t: 0, w: 0, h: 0, c: '', r: -1 },\r\n\t\t\teditText: '',\r\n\t\t\tselStart: { c: 0, r: 0 }\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tstartX() {\r\n\t\t\treturn rowHeaderWidth + (this.rowsCombo ? rowComboWidth : 0);\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\trowFromPoint(pointY) {\r\n\t\t\tlet y = columnHeaderHeigth;\r\n\t\t\tfor (const r of this.renderedRows()) {\r\n\t\t\t\tlet rh = this.rowHeight(r);\r\n\t\t\t\tif (pointY >= y && pointY <= (y + rh))\r\n\t\t\t\t\treturn { row: r, top: y, height: rh };\r\n\t\t\t\ty += rh;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tcolFromPoint(pointX) {\r\n\t\t\tlet x = this.startX;\r\n\t\t\tfor (const c of this.renderedColumns()) {\r\n\t\t\t\tlet cw = this.colWidth(c);\r\n\t\t\t\tif (pointX >= x && pointX <= (x + cw))\r\n\t\t\t\t\treturn { col: c, left: x, width: cw };\r\n\t\t\t\tx += cw;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tcolWidth(c) {\r\n\t\t\tlet col = this.sheet.Columns[toColRef(c)];\r\n\t\t\treturn col ? col.Width : defaultColumWidth;\r\n\t\t},\r\n\t\trowHeight(r) {\r\n\t\t\tlet row = this.sheet.Rows[r + 1];\r\n\t\t\treturn row ? row.Height : defaultRowHeight;\r\n\t\t},\r\n\t\tgetOrCreateRow(r) {\r\n\t\t\tlet row = this.sheet.Rows[r + 1];\r\n\t\t\tif (!row) {\r\n\t\t\t\trow = {};\r\n\t\t\t\tVue.set(this.sheet.Rows, r + 1, row);\r\n\t\t\t}\r\n\t\t\treturn row;\r\n\t\t},\r\n\t\tgetOrCreateColumn(c) {\r\n\t\t\tlet colRef = toColRef(c);\r\n\t\t\tlet col = this.sheet.Columns[colRef];\r\n\t\t\tif (!col) {\r\n\t\t\t\tcol = {};\r\n\t\t\t\tVue.set(this.sheet.Columns, colRef, col);\r\n\t\t\t}\r\n\t\t\treturn col;\r\n\t\t},\r\n\t\tselRect(s) {\r\n\t\t\tlet xc = s.left; let xr = s.top;\r\n\t\t\tlet y = columnHeaderHeigth;\r\n\t\t\tlet rect = { left: 0, top: 0, height: 0, width: 0 };\r\n\t\t\tfor (const r of this.renderedRows()) {\r\n\t\t\t\tlet rh = this.rowHeight(r);\r\n\t\t\t\tif (r === xr) {\r\n\t\t\t\t\trect.top = y; rect.height = rh;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse if (r > xr)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\ty += rh;\r\n\t\t\t}\r\n\t\t\tlet x = this.startX;\r\n\t\t\tfor (const c of this.renderedColumns()) {\r\n\t\t\t\tlet cw = this.colWidth(c);\r\n\t\t\t\tif (c === xc) {\r\n\t\t\t\t\trect.left = x, rect.width = cw;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse if (c > xc)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tx += cw;\r\n\t\t\t}\r\n\t\t\treturn rect;\r\n\t\t},\r\n\t\tpointFromEvent(ev) {\r\n\t\t\tlet cont = this.$refs.container;\r\n\t\t\tlet rect = cont.getBoundingClientRect();\r\n\t\t\tlet y = ev.clientY - rect.top;\r\n\t\t\tlet x = ev.clientX - rect.left;\r\n\t\t\treturn { x, y };\r\n\t\t},\r\n\t\tsetPosX(pos) {\r\n\t\t\tthis.scrollPos.x = pos;\r\n\t\t},\r\n\t\tsetPosY(pos) {\r\n\t\t\tthis.scrollPos.y = pos;\r\n\t\t},\r\n\t\trenderedRows: function* () {\r\n\t\t\tlet sh = this.sheet;\r\n\t\t\tfor (let f = 0; f < sh.Fixed.Rows; f++)\r\n\t\t\t\tyield f;\r\n\t\t\tfor (let f = this.scrollPos.y; f < sh.Size.Rows; /* maxRows ??*/ f++)\r\n\t\t\t\tyield f;\r\n\t\t},\r\n\t\trenderedColumns: function* () {\r\n\t\t\tlet sh = this.sheet;\r\n\t\t\tfor (let c = 0; c < sh.Fixed.Columns; c++)\r\n\t\t\t\tyield c;\r\n\t\t\tfor (let c = this.scrollPos.x; c < sh.Size.Columns; /*maxColumns ?? */ c++)\r\n\t\t\t\tyield c;\r\n\t\t},\r\n\t\tsetPos(c, r) {\r\n\t\t\tlet sa = this.sheet.$selection;\r\n\t\t\tif (!sa || !sa.length) return;\r\n\t\t\tlet sel = sa[0];\r\n\t\t\tlet sh = this.sheet;\r\n\t\t\tlet fix = sh.Fixed;\r\n\t\t\tlet sz = sh.Size;\r\n\t\t\tif (c < 0) c = 0;\r\n\t\t\tif (c > sz.Columns - 1) c = sz.Columns - 1;\r\n\t\t\tif (r < 0) r = 0;\r\n\t\t\tif (r > sz.Rows - 1) r = sz.Rows - 1;\r\n\t\t\tsel.left = c; sel.right = c + 1;\r\n\t\t\tsel.top = r; sel.bottom = r + 1;\r\n\t\t\tthis.fitScrollPos();\r\n\t\t},\r\n\t\tmousewheel(ev) {\r\n\t\t\tlet deltaY = +(ev.deltaY / 100).toFixed();\r\n\t\t\tif (deltaY > 0)\r\n\t\t\t\tthis.scrollPos.y = Math.min(this.scrollPos.y + deltaY, this.sheet.Size.Rows - this.vScrollPageSize());\r\n\t\t\telse\r\n\t\t\t\tthis.scrollPos.y = Math.max(this.scrollPos.y + deltaY, this.sheet.Fixed.Rows);\r\n\t\t},\r\n\t\tkeydown(ev) {\r\n\t\t\tlet sa = this.sheet.$selection;\r\n\t\t\tif (!sa || !sa.length) return;\r\n\t\t\tlet sel = sa[0];\r\n\t\t\tswitch (ev.which) {\r\n\t\t\t\tcase 37: /* left */\r\n\t\t\t\t\tthis.setPos(sel.left - 1, sel.top);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 38: /* up */\r\n\t\t\t\t\tthis.setPos(sel.left, sel.top - 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 39: /* right */\r\n\t\t\t\t\tthis.setPos(sel.left + 1, sel.top);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 40: /* down */\r\n\t\t\t\t\tthis.setPos(sel.left, sel.top + 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 34: /* pgdn */\r\n\t\t\t\t\tthis.setPos(sel.left, sel.top + this.vScrollPageSize() + this.sheet.Fixed.Rows /*TODO last visible row*/);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 33: /* pgup */\r\n\t\t\t\t\tthis.setPos(sel.left, sel.top - this.vScrollPageSize()/*TODO* first visible row*/);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 36: /* home */\r\n\t\t\t\t\tthis.setPos(0, sel.top);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 35: /* end */\r\n\t\t\t\t\tthis.setPos(this.sheet.Size.Columns - 1, sel.top);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 113: /* F2 */\r\n\t\t\t\t\tlet sr = this.selRect(sel);\r\n\t\t\t\t\tthis.doEdit({ col: sel.left, left: sr.left, width: sr.width },\r\n\t\t\t\t\t\t{ row: sel.top, top: sr.top, heigth: sr.height }\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.dir(ev.which);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\t\tfitSpan(cp, rp) {\r\n\t\t\tif (!cp || !rp) return;\r\n\t\t\tlet cellRef = `${toColRef(cp.col)}${rp.row + 1}`;\r\n\t\t\tlet cell = this.sheet.Cells[cellRef];\r\n\t\t\tif (cell) {\r\n\t\t\t\tif (cell.ColSpan > 1)\r\n\t\t\t\t\tfor (let c = 1; c < cell.ColSpan; c++)\r\n\t\t\t\t\t\tcp.width += this.colWidth(cp.col + c);\r\n\t\t\t\tif (cell.RowSpan > 1)\r\n\t\t\t\t\tfor (let r = 1; r < cell.RowSpan; r++)\r\n\t\t\t\t\t\trp.height += this.rowHeight(rp.row + r);\r\n\t\t\t}\r\n\t\t},\r\n\t\tdblclick(ev) {\r\n\t\t\tif (ev.srcElement.classList.contains('no-me'))\r\n\t\t\t\treturn;\r\n\t\t\tlet p = this.pointFromEvent(ev);\r\n\t\t\tlet cp = this.colFromPoint(p.x);\r\n\t\t\tlet rp = this.rowFromPoint(p.y);\r\n\t\t\tthis.fitSpan(cp, rp);\r\n\t\t\tthis.doEdit(cp, rp);\r\n\t\t},\r\n\t\tsetProp(c, r, cb, create) {\r\n\t\t\tlet cellRef = `${toColRef(c)}${r + 1}`;\r\n\t\t\tlet cell = this.sheet.Cells[cellRef];\r\n\t\t\tif (!cell && create) {\r\n\t\t\t\tcell = {};\r\n\t\t\t\tVue.set(this.sheet.Cells, cellRef, cell);\r\n\t\t\t}\r\n\t\t\tif (cell)\r\n\t\t\t\tcb(cell);\r\n\t\t},\r\n\t\tendEdit(val) {\r\n\t\t\tlet r = this.editRect;\r\n\t\t\tlet cellRef = `${toColRef(r.c)}${r.r + 1}`;\r\n\t\t\tlet cell = this.sheet.Cells[cellRef];\r\n\t\t\tif (!cell) {\r\n\t\t\t\tif (!val) return;\r\n\t\t\t\tcell = { Content: val }\r\n\t\t\t\tVue.set(this.sheet.Cells, cellRef, cell);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tcell.Content = val;\r\n\t\t},\r\n\t\tstartEdit(c, r) {\r\n\t\t\treturn { control: 'editor' };\r\n\t\t},\r\n\t\tdoEdit(cp, rp) {\r\n\t\t\tif (!cp || !rp) return;\r\n\t\t\tlet res = this.startEdit(toColRef(cp.col), rp.row);\r\n\t\t\tif (!res)\r\n\t\t\t\treturn;\r\n\t\t\tlet er = this.editRect;\r\n\t\t\ter.l = cp.left;\r\n\t\t\ter.t = rp.top;\r\n\t\t\ter.w = cp.width;\r\n\t\t\ter.h = rp.height;\r\n\t\t\ter.c = cp.col;\r\n\t\t\ter.r = rp.row;\r\n\t\t\tlet c = this.sheet.Cells[`${toColRef(cp.col)}${rp.row + 1}`];\r\n\t\t\tif (c)\r\n\t\t\t\tthis.editText = c.Content;\r\n\t\t\telse\r\n\t\t\t\tthis.editText = '';\r\n\t\t\tthis.editing = true;\r\n\r\n\t\t},\r\n\t\tpointerdown(ev) {\r\n\t\t\tif (ev.srcElement.classList.contains('no-me'))\r\n\t\t\t\treturn;\r\n\t\t\tev.target.setPointerCapture(ev.pointerId);\r\n\t\t\tthis.editing = false;\r\n\t\t\tthis.editText = false;\r\n\t\t\tthis.selecting = true;\r\n\t\t\tlet sht = this.sheet;\r\n\t\t\tlet sa = sht.$selection;\r\n\t\t\tlet p = this.pointFromEvent(ev);\r\n\t\t\tif (p.x < this.startX) {\r\n\t\t\t\tlet rp = this.rowFromPoint(p.y);\r\n\t\t\t\tsa.length = 0;\r\n\t\t\t\tlet sp = { left: 0, top: rp.row, right: sht.Size.Columns + 1, bottom: rp.row + 1 };\r\n\t\t\t\tsa.push(sp);\r\n\t\t\t}\r\n\t\t\telse if (p.y < columnHeaderHeigth) {\r\n\t\t\t\tlet cp = this.colFromPoint(p.x);\r\n\t\t\t\tsa.length = 0;\r\n\t\t\t\tlet sp = { left: cp.col, top: 0, right: cp.col + 1, bottom: sht.Size.Rows + 1 };\r\n\t\t\t\tsa.push(sp);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet sp = this.createSelRect(p.x, p.y);\r\n\t\t\t\tif (sp) {\r\n\t\t\t\t\tsa.length = 0;\r\n\t\t\t\t\tsa.push(sp);\r\n\t\t\t\t\tthis.selStart.x = sp.left;\r\n\t\t\t\t\tthis.selStart.y = sp.top;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tpointermove(ev) {\r\n\t\t\tif (!this.selecting) return;\r\n\t\t\tif (ev.srcElement.classList.contains('no-me'))\r\n\t\t\t\treturn;\r\n\t\t\tlet p = this.pointFromEvent(ev);\r\n\t\t\tlet sa = this.sheet.$selection;\r\n\t\t\tif (!sa || !sa.length) return;\r\n\t\t\tlet sel = sa[0];\r\n\t\t\tif (p.x < this.startX) {\r\n\t\t\t\tlet rp = this.rowFromPoint(p.y);\r\n\t\t\t\tconsole.dir('select rows');\r\n\t\t\t}\r\n\t\t\telse if (p.y < columnHeaderHeigth) {\r\n\t\t\t\tlet cp = this.colFromPoint(p.x);\r\n\t\t\t\tconsole.dir('select columns');\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet sp = this.createSelRect(p.x, p.y);\r\n\t\t\t\tif (sp.left == this.selStart.x) {\r\n\t\t\t\t\tsel.left = sp.left;\r\n\t\t\t\t\tsel.right = sp.right;\r\n\t\t\t\t} if (sp.left < this.selStart.x)\r\n\t\t\t\t\tsel.left = sp.left;\r\n\t\t\t\telse\r\n\t\t\t\t\tsel.right = sp.right;\r\n\t\t\t\tif (sp.top == this.selStart.y) {\r\n\t\t\t\t\tsel.top = sp.top;\r\n\t\t\t\t\tsel.bottom = sp.bottom;\r\n\t\t\t\t} else if (sp.top < this.selStart.y)\r\n\t\t\t\t\tsel.top = sp.top;\r\n\t\t\t\telse\r\n\t\t\t\t\tsel.bottom = sp.bottom;\r\n\t\t\t\tthis.fitScrollPos();\r\n\t\t\t}\r\n\t\t},\r\n\t\tpointerup(ev) {\r\n\t\t\tev.target.setPointerCapture(ev.pointerId);\r\n\t\t\tthis.selecting = false;\r\n\t\t\tthis.selStart.x = 0;\r\n\t\t\tthis.selStart.y = 0;\r\n\t\t\tthis.fitScrollPos();\r\n\t\t},\r\n\t\tfitScrollPos() {\r\n\t\t\tlet sa = this.sheet.$selection;\r\n\t\t\tif (!sa || !sa.length) return;\r\n\t\t\tlet sel = sa[0];\r\n\t\t\tlet cont = this.$refs.container;\r\n\t\t\tlet cWidth = cont.clientWidth - 1; //- rowHeaderWidth;\r\n\t\t\tlet cHeight = cont.clientHeight - 1; //- columnHeaderHeigth;\r\n\t\t\tlet fix = this.sheet.Fixed;\r\n\t\t\tlet sp = this.scrollPos;\r\n\t\t\tlet sr = null;\r\n\t\t\tif (sp.y > fix.Rows && sel.top < sp.y)\r\n\t\t\t\tsp.y = Math.max(sel.top, fix.Rows);\r\n\t\t\telse {\r\n\t\t\t\tsr = sr || this.selRect(sel);\r\n\t\t\t\tlet b = sr.top + sr.height + 1;\r\n\t\t\t\tif (b > cHeight)\r\n\t\t\t\t\tsp.y += 1;\r\n\t\t\t}\r\n\t\t\tif (sp.x > fix.Columns && sel.left < sp.x)\r\n\t\t\t\tsp.x = Math.max(sel.left, fix.Columns);\r\n\t\t\telse {\r\n\t\t\t\tsr = sr || this.selRect(sel);\r\n\t\t\t\tlet r = sr.left + sr.width + 1;\r\n\t\t\t\tif (r > cWidth)\r\n\t\t\t\t\tsp.x += 1;\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreateSelRect(x, y) {\r\n\t\t\tlet rp = this.rowFromPoint(y);\r\n\t\t\tlet cp = this.colFromPoint(x);\r\n\t\t\tif (cp && rp) {\r\n\t\t\t\tlet cellRef = `${toColRef(cp.col)}${rp.row + 1}`;\r\n\t\t\t\tlet cell = this.sheet.Cells[cellRef];\r\n\t\t\t\treturn { left: cp.col, top: rp.row, right: cp.col + 1 + (cell?.ColSpan - 1 || 0), bottom: rp.row + 1 + (cell?.RowSpan - 1 || 0) };\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tisInSelection(cb, cell) {\r\n\t\t\treturn this.sheet.$selection.some(c => cb(c, this.sheet.Cells[`${toColRef(c.left)}${c.top + 1}`]));\r\n\t\t},\r\n\t\tcellClass(cell) {\r\n\t\t\tif (!cell) return '';\r\n\t\t\tlet c = '';\r\n\t\t\tif (cell.Bold)\r\n\t\t\t\tc += ' bold';\r\n\t\t\tif (cell.Italic)\r\n\t\t\t\tc += ' italic';\r\n\t\t\treturn c;\r\n\t\t},\r\n\t\thScrollPageSize() {\r\n\t\t\tlet cont = this.$refs.container;\r\n\t\t\tif (!cont)\r\n\t\t\t\treturn 0;\r\n\t\t\tlet x = this.startX;\r\n\t\t\tlet max = cont.clientWidth;\r\n\t\t\tlet cols = 0;\r\n\t\t\tfor (let c of this.renderedColumns()) {\r\n\t\t\t\tx += this.colWidth(c);\r\n\t\t\t\tif (x > max)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\telse if (c >= this.sheet.Fixed.Columns)\r\n\t\t\t\t\tcols += 1;\r\n\t\t\t}\r\n\t\t\t//console.dir(cols);\r\n\t\t\treturn cols;\r\n\t\t},\r\n\t\tvScrollPageSize() {\r\n\t\t\tlet cont = this.$refs.container;\r\n\t\t\tif (!cont)\r\n\t\t\t\treturn 0;\r\n\t\t\tlet y = columnHeaderHeigth;\r\n\t\t\tlet max = cont.clientHeight;\r\n\t\t\tlet rows = 0;\r\n\t\t\tfor (let r of this.renderedRows()) {\r\n\t\t\t\ty += this.rowHeight(r);\r\n\t\t\t\tif (y > max)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\telse if (r >= this.sheet.Fixed.Rows)\r\n\t\t\t\t\trows += 1;\r\n\t\t\t}\r\n\t\t\t//console.dir(rows);\r\n\t\t\treturn rows;\r\n\t\t}\r\n\t},\r\n\tmounted() {\r\n\t\tthis.updateCount += 1;\r\n\t\tlet sp = { left: 0, top: 0, right: 1, bottom: 1 };\r\n\t\tthis.sheet.$selection.push(sp);\r\n\t\tthis.scrollPos.x = this.sheet.Fixed.Columns;\r\n\t\tthis.scrollPos.y = this.sheet.Fixed.Rows;\r\n\t\tthis.__ro = new ResizeObserver(x => {\r\n\t\t\tthis.updateCount += 1;\r\n\t\t\tthis.fitScrollPos();\r\n\t\t});\r\n\t\tthis.__ro.observe(this.$el);\r\n\t},\r\n\tbeforeDestroy() {\r\n\t\tif (this.__ro)\r\n\t\t\tthis.__ro.unobserve(this.$el);\r\n\t}\r\n});"],"names":["toColRef","n","String","fromCharCode","Math","floor","toPx","columnHeaderHeigth","Vue","component","template","props","horz","Boolean","page","Number","pos","min","max","setPos","Function","data","tempClientSize","moving","delta","thumbMovePos","computed","sbClass","this","thumbPos","size","clientSize","s","$refs","body","clientWidth","clientHeight","thumbSize","sz","thumbStyle","left","width","top","height","decDisabled","incDisabled","decLabel","incLabel","methods","dec","setPosCheck","inc","np","clickBody","ev","offsetX","offsetY","thumbDown","target","setPointerCapture","pointerId","hors","thumbMove","rect","getBoundingClientRect","tpos","clientX","clientY","ths","maxPos","thumbUp","releasePointerCapture","step","toFixed","mounted","spreadSheetCanvas","rType","rItem","rPt","rSize","clearData","onUp","cb","stopPropagation","ns","hMouseDown","ep","$parent","pointFromEvent","col","colFromPoint","x","hMouseUp","nw","getOrCreateColumn","set","hMouseMove","vMouseDown","row","rowFromPoint","y","vMouseUp","nh","getOrCreateRow","vMouseMove","render","h","parent","sh","sheet","cont","container","maxWidth","maxHeigth","elems","self","startX","right","bottom","headers","push","class","c","renderedColumns","colRef","cw","colWidth","cls","isInSelection","sel","cell","ColSpan","Size","Columns","style","on","pointerdown","pointerup","pointermove","topHeader","r","renderedRows","rh","rowHeight","RowSpan","Rows","leftHeader","gridLines","console","dir","Fixed","vLines","hLines","spreadSheetCell","p","cellRef","Cells","sc","sr","cellCls","cellClass","Content","spreadSheetCells","spreadSheetSelection","$selection","ch","i","length","selRect","cx","rx","spreadSheetEdit","blur","endEdit","innerText","editRect","l","t","w","domProps","contentEditable","editText","$el","focus","spreadSheetToolbar","forAll","prop","setProp","components","Object","type","default","rowsCombo","editable","updateCount","scrollPos","editing","selecting","selStart","pointY","pointX","Width","Height","xc","xr","setPosX","setPosY","f","sa","fitScrollPos","mousewheel","deltaY","vScrollPageSize","keydown","which","doEdit","heigth","fitSpan","cp","rp","dblclick","srcElement","classList","contains","create","val","startEdit","control","er","sht","sp","createSelRect","cWidth","cHeight","fix","some","Bold","Italic","hScrollPageSize","cols","rows","__ro","ResizeObserver","observe","beforeDestroy","unobserve"],"mappings":"2FACO,MAAMA,EAAYC,GAAMA,GAAK,GAAKC,OAAOC,aAAaC,KAAKC,MAAMJ,EAAI,IAAM,IAAMC,OAAOC,aAAaF,EAAI,GAAK,IAAMC,OAAOC,aAAaF,EAAI,IACtIK,EAAQL,GAAMA,EAAI,KAGlBM,EAAqB,GCFlCC,IAAIC,UAAU,gBAAiB,CAC9BC,SAAU,+cAWVC,MAAO,CACNC,KAAMC,QACNC,KAAMC,OACNC,IAAKD,OACLE,IAAKF,OACLG,IAAKH,OACLI,OAAQC,UAETC,KAAI,KACI,CACNC,eAAgB,EAChBC,QAAQ,EACRC,MAAO,EACPC,aAAc,IAGhBC,SAAU,CACT,OAAAC,GACC,OAAOC,KAAKhB,KAAO,OAAS,MAC5B,EACD,QAAAiB,GACC,GAAID,KAAKL,OACR,OAAOK,KAAKH,aAEb,OADYG,KAAe,WAAKA,KAAS,MAC1BA,KAAKZ,IAAMY,KAAKX,IAC/B,EACD,IAAAa,GACC,OAAOF,KAAKV,IAAMU,KAAKX,GACvB,EACD,UAAAc,GACC,IAAIC,EAAIJ,KAAKN,eAGb,OAFIM,KAAKK,MAAMC,OACdF,EAAKJ,KAAKhB,KAAOgB,KAAKK,MAAMC,KAAKC,YAAcP,KAAKK,MAAMC,KAAKE,cACzDJ,CACP,EACD,SAAAK,GACC,IAAIC,EAAKV,KAAKG,WACd,OAAOH,KAAKd,KAAOwB,EAAKV,KAAKE,IAC7B,EACD,UAAAS,GACC,OAAIX,KAAKhB,KACD,CAAE4B,KAAMlC,EAAKsB,KAAKC,UAAWY,MAAOnC,EAAKsB,KAAKS,YAE9C,CAAEK,IAAKpC,EAAKsB,KAAKC,UAAWc,OAAQrC,EAAKsB,KAAKS,WACtD,EACD,WAAAO,GACC,OAAOhB,KAAKZ,KAAOY,KAAKX,GACxB,EACD,WAAA4B,GACC,OAAOjB,KAAKZ,KAAOY,KAAKV,IAAMU,KAAKd,IACnC,EACD,QAAAgC,GAAa,OAAOlB,KAAKhB,KAAO,IAAM,GAAM,EAC5C,QAAAmC,GAAa,OAAOnB,KAAKhB,KAAO,IAAM,GAAM,GAE7CoC,QAAS,CACR,GAAAC,GACCrB,KAAKsB,YAAYtB,KAAKZ,IAAM,EAC5B,EACD,GAAAmC,GACCvB,KAAKsB,YAAYtB,KAAKZ,IAAM,EAC5B,EACD,WAAAkC,CAAYE,GACPA,EAAKxB,KAAKX,MACbmC,EAAKxB,KAAKX,KACPmC,EAAKxB,KAAKV,IAAMU,KAAKd,OACxBsC,EAAKxB,KAAKV,IAAMU,KAAKd,MACtBc,KAAKT,OAAOiC,EACZ,EACD,SAAAC,CAAUC,GACT,IACIF,EAAK,EAERA,GAHQxB,KAAKhB,KAAO0C,EAAGC,QAAUD,EAAGE,SAE5B5B,KAAKC,SACRD,KAAKZ,IAAMY,KAAKd,KAEhBc,KAAKZ,IAAMY,KAAKd,KACtBc,KAAKsB,YAAYE,EACjB,EACD,SAAAK,CAAUH,GACTA,EAAGI,OAAOC,kBAAkBL,EAAGM,WAC/BhC,KAAKJ,MAAQI,KAAKiC,KAAOP,EAAGC,QAAUD,EAAGE,QACzC5B,KAAKH,aAAeG,KAAKC,SACzBD,KAAKL,QAAS,CACd,EACD,SAAAuC,CAAUR,GACT,IAAK1B,KAAKL,OAAQ,OAClB,IAAIwC,EAAOnC,KAAKK,MAAMC,KAAK8B,wBACvBC,EAAOrC,KAAKhB,KAAO0C,EAAGY,QAAUtC,KAAKJ,MAAQuC,EAAKvB,KAAOc,EAAGa,QAAUvC,KAAKJ,MAAQuC,EAAKrB,IACxFuB,EAAO,IAAGA,EAAO,GACrB,IAAIG,EAAMxC,KAAKS,UACXgC,EAASzC,KAAKhB,KAAOmD,EAAKtB,MAAQ2B,EAAML,EAAKpB,OAASyB,EACtDH,EAAOI,IAAQJ,EAAOI,GAC1BzC,KAAKH,aAAewC,CACpB,EACD,OAAAK,CAAQhB,GACPA,EAAGI,OAAOa,sBAAsBjB,EAAGM,WACnC,IAAI5C,EAAMY,KAAKH,aACfG,KAAKL,QAAS,EACd,IAAIiD,EAAO5C,KAAKG,YAAcH,KAAKV,IAAMU,KAAKX,KAC1CmC,EAAKhD,KAAKa,MAAOD,EAAMwD,GAAMC,UAAW7C,KAAKV,IAAMU,KAAKd,MAC5Dc,KAAKsB,YAAYE,EAAKxB,KAAKX,IAC3B,GAEF,OAAAyD,GACC9C,KAAKN,eAAkBM,KAAKhB,KAAOgB,KAAKK,MAAMC,KAAKC,YAAcP,KAAKK,MAAMC,KAAKE,YACjF,ICpHa,IAAAuC,EAAA,CACdtD,KAAI,KACI,CACNuD,MAAO,GACPC,OAAS,EACTC,KAAO,EACPC,OAAS,EACTvD,MAAO,IAGTwB,QAAS,CACR,SAAAgC,GACCpD,KAAKgD,MAAQ,GACbhD,KAAKiD,SACLjD,KAAKmD,MAAQ,EACbnD,KAAKkD,IAAM,EACXlD,KAAKJ,MAAQ,CACb,EACD,IAAAyD,CAAK3B,EAAI4B,GAGR,GAFA5B,EAAGI,OAAOa,sBAAsBjB,EAAGM,WACnCN,EAAG6B,kBACCvD,KAAKiD,MAAQ,EAChB,OACD,IAAIO,EAAKxD,KAAKkD,IAAMlD,KAAKmD,MACrBK,EAAK,IACRA,EAAK,GACNF,EAAGE,GACHxD,KAAKoD,WACL,EACD,UAAAK,CAAW/B,GACVA,EAAG6B,kBACH,IAAIG,EAAK1D,KAAK2D,QAAQC,eAAelC,GACjCmC,EAAM7D,KAAK2D,QAAQG,aAAaJ,EAAGK,GAClCF,IACLnC,EAAGI,OAAOC,kBAAkBL,EAAGM,WAC/BhC,KAAKgD,MAAQ,IACbhD,KAAKiD,MAAQY,EAAIA,IACjB7D,KAAKkD,IAAMW,EAAIjD,KAAOiD,EAAIhD,MAC1Bb,KAAKmD,MAAQU,EAAIjD,KACjBZ,KAAKJ,MAAQI,KAAKkD,IAAMxB,EAAGY,QAC3B,EACD,QAAA0B,CAAStC,GACR1B,KAAKqD,KAAK3B,GAAIuC,IACb,IAAIJ,EAAM7D,KAAK2D,QAAQO,kBAAkBlE,KAAKiD,OAC9CrE,IAAIuF,IAAIN,EAAK,QAASI,EAAG,GAE1B,EACD,UAAAG,CAAW1C,GACN1B,KAAKiD,MAAQ,IAEjBjD,KAAKkD,IAAMxB,EAAGY,QAAUtC,KAAKJ,MAC7B,EACD,UAAAyE,CAAW3C,GACVA,EAAG6B,kBACH,IAAIG,EAAK1D,KAAK2D,QAAQC,eAAelC,GACjC4C,EAAMtE,KAAK2D,QAAQY,aAAab,EAAGc,GAClCF,IACL5C,EAAGI,OAAOC,kBAAkBL,EAAGM,WAC/BhC,KAAKgD,MAAQ,IACbhD,KAAKiD,MAAQqB,EAAIA,IACjBtE,KAAKkD,IAAMoB,EAAIxD,IAAMwD,EAAIvD,OACzBf,KAAKmD,MAAQmB,EAAIxD,IACjBd,KAAKJ,MAAQI,KAAKkD,IAAMxB,EAAGa,QAC3B,EACD,QAAAkC,CAAS/C,GACR1B,KAAKqD,KAAK3B,GAAIgD,IACb,IAAIJ,EAAMtE,KAAK2D,QAAQgB,eAAe3E,KAAKiD,OAC3CrE,IAAIuF,IAAIG,EAAK,SAAUI,EAAG,GAE3B,EACD,UAAAE,CAAWlD,GACN1B,KAAKiD,MAAQ,IAEjBjD,KAAKkD,IAAMxB,EAAGa,QAAUvC,KAAKJ,MAC7B,GAEF,MAAAiF,CAAOC,GACN,IAAIC,EAAS/E,KAAK2D,QACdqB,EAAKD,EAAOE,MACZC,EAAOH,EAAO1E,MAAM8E,UACxB,IAAKD,EACJ,OACD,IAAIE,EAAWF,EAAK3E,YAChB8E,EAAYH,EAAK1E,aACjB8E,EAAQ,GACRC,EAAOvF,KACPwF,EAAST,EAAOS,OAEhB/C,EAAS,CAAEgD,MAAO,EAAGC,OAAQ,GAkGjC,OArBIX,EAAOY,SACVL,EAAMM,KAAKd,EAAE,MAAO,CAAEe,MAAO,WAjD9B,WACC,IAAI9B,EAAIyB,EACR,IAAK,MAAMM,KAAKf,EAAOgB,kBAAmB,CACzC,IAAIC,EAAS5H,EAAS0H,GAClBG,EAAKlB,EAAOmB,SAASJ,GACrBK,EAAM,MAaV,GAZIpB,EAAOqB,eAAc,CAACC,EAAKC,IAASR,GAAKO,EAAIzF,MAAQkF,GAAKO,EAAIzF,MAAQ0F,GAAMC,QAAU,GAAK,OAC9FJ,GAAO,YACJL,IAAMd,EAAGwB,KAAKC,QAAU,IAC3BN,GAAO,QACPF,GAAM,GAEPX,EAAMM,KAAKd,EAAE,MAAO,CAAEe,MAAOM,EAAKO,MAAO,CAAE7F,MAAOnC,EAAKuH,GAAKrF,KAAMlC,EAAKqF,KAAQ,CAACiC,EAC/ElB,EAAE,MAAO,CACRe,MAAO,eACPc,GAAI,CAAEC,YAAarB,EAAK9B,WAAYoD,UAAWtB,EAAKvB,SAAU8C,YAAavB,EAAKnB,iBAElFL,GAAKkC,EACDlC,GAAKqB,EACR,KACD,CACD3C,EAAOgD,MAAQ1B,EFzIY,GEyIS,CACpC,CA4BAgD,GA1BD,WACC,IAAIvC,EAAI7F,EACR,IAAK,MAAMqI,KAAKjC,EAAOkC,eAAgB,CACtC,IAAIC,EAAKnC,EAAOoC,UAAUH,GACtBb,EAAM,MAaV,GAZIpB,EAAOqB,eAAc,CAACC,EAAKC,IAASU,GAAKX,EAAIvF,KAAOkG,GAAKX,EAAIvF,KAAOwF,GAAMc,QAAU,GAAK,OAC5FjB,GAAO,YACJa,IAAMhC,EAAGwB,KAAKa,KAAO,IACxBlB,GAAO,QACPe,GAAM,GAEP5B,EAAMM,KAAKd,EAAE,MAAO,CAAEe,MAAOM,EAAKO,MAAO,CAAE3F,OAAQrC,EAAKwI,GAAKpG,IAAKpC,EAAK8F,KAAQ,CAAC,IAAMwC,EAAI,GAC1FlC,EAAE,MAAO,CACRe,MAAO,eACPc,GAAI,CAAEC,YAAarB,EAAKlB,WAAYwC,UAAWtB,EAAKd,SAAUqC,YAAavB,EAAKX,iBAEjFJ,GAAK0C,EACD1C,GAAKa,EACR,KAED,CACD5C,EAAOiD,OAASlB,EAAI7F,EAAqB,CACzC,CAKA2I,IACUvC,EAAOwC,WACjBC,QAAQC,IAAI,eAGT1C,EAAOwC,YAnFX,WACC,IAAIxD,EAAIyB,EACR,IAAK,MAAMM,KAAKf,EAAOgB,kBAAmB,CAEzC,GADAhC,GAAKgB,EAAOmB,SAASJ,GACjB/B,GAAKqB,EACR,MACD,IAAIe,EAAM,QACNL,GAAKd,EAAG0C,MAAMjB,QAAU,IAC3BN,GAAO,WACRb,EAAMM,KAAKd,EAAE,MAAO,CAAEe,MAAOM,EAAKO,MAAO,CAAE9F,KAAMlC,EAAKqF,GAAIhD,OAAQrC,EAAK+D,EAAOiD,WAC9E,CACD,CAyEAiC,GAvED,WACC,IAAInD,EAAI7F,EACR,IAAK,MAAMqI,KAAKjC,EAAOkC,eAAgB,CAGtC,GADAzC,GADSO,EAAOoC,UAAUH,GAEtBxC,GAAKa,EACR,MACD,IAAIc,EAAM,QACNa,IAAMhC,EAAG0C,MAAML,KAAO,IACzBlB,GAAO,WACRb,EAAMM,KAAKd,EAAE,MAAO,CAAEe,MAAOM,EAAKO,MAAO,CAAE5F,IAAKpC,EAAK8F,GAAI3D,MAAOnC,EAAK+D,EAAOgD,UAC5E,CACD,CA4DAmC,IAGG5H,KAAKiD,OAAS,IACC,KAAdjD,KAAKgD,MACRsC,EAAMM,KAAKd,EAAE,MAAO,CAAEe,MAAO,gBAAiBa,MAAO,CAAE9F,KAAMlC,EAAKsB,KAAKkD,SAEvEoC,EAAMM,KAAKd,EAAE,MAAO,CAAEe,MAAO,gBAAiBa,MAAO,CAAE5F,IAAKpC,EAAKsB,KAAKkD,UAIjE4B,EAAE,MAAO,CAAEe,MAAO,UAAYP,EACrC,GC3LauC,EAAA,CACd,MAAAhD,CAAOC,GACN,IAAIgD,EAAI9H,KAAK2D,QACTqB,EAAK8C,EAAE7C,MACPC,EAAO4C,EAAEzH,MAAM8E,UACnB,IAAKD,EACJ,OACD,IAAIE,EAAWF,EAAK3E,YAChB8E,EAAYH,EAAK1E,aACjB8E,EAAQ,GACRd,EAAI7F,mBACR,MAAM6G,EAASsC,EAAEtC,OACjB,IAAK,MAAMwB,KAAKc,EAAEb,eAAgB,CACjC,IAAIlD,EAAIyB,EACJ0B,EAAKlH,KAAK2D,QAAQwD,UAAUH,GAChC,IAAK,MAAMlB,KAAKgC,EAAE/B,kBAAmB,CACpC,IAAIC,EAAS5H,EAAS0H,GAClBG,EAAK6B,EAAE5B,SAASJ,GACpB,MAAMiC,EAAU,GAAG/B,IAASgB,EAAI,IAChC,IAAIV,EAAOtB,EAAGgD,MAAMD,GACpB,GAAIzB,EAAM,CACT,GAAIA,EAAKC,QAAU,GAAKD,EAAKc,QAAU,EAAG,CACzC,IAAInD,EAAKgC,EACLvB,EAAKwC,EACT,IAAK,IAAIe,EAAK,EAAGA,EAAK3B,EAAKC,QAAS0B,IACnChE,GAAM6D,EAAE5B,SAAS+B,EAAKnC,GACvB,IAAK,IAAIoC,EAAK,EAAGA,EAAK5B,EAAKc,QAASc,IACnCxD,GAAMoD,EAAEX,UAAUe,EAAKlB,GACxB1B,EAAMM,KAAKd,EAAE,MAAO,CACnBe,MAAO,UACPa,MAAO,CAAE9F,KAAMlC,KAAKqF,EAAI,GAAIjD,IAAKpC,KAAK8F,EAAI,GAAI3D,MAAOnC,KAAKuF,EAAK,GAAIlD,OAAQrC,KAAKgG,EAAK,MAEtF,CACD,IAAIyD,EAAU,OAASL,EAAEM,UAAU9B,GACnChB,EAAMM,KAAKd,EAAE,MAAO,CACnBe,MAAOsC,EACPzB,MAAO,CAAE9F,KAAMlC,KAAKqF,GAAIjD,IAAKpC,KAAK8F,GAAI3D,MAAOnC,KAAKuH,EAAK,GAAIlF,OAAQrC,KAAKwI,EAAK,KAE7EZ,EAAK+B,SACN,CAED,GADAtE,GAAKkC,EACDlC,GAAKqB,EACR,KACD,CAED,GADAZ,GAAK0C,EACD1C,GAAKa,EACR,KACD,CACD,OAAOP,EAAE,MAAO,CAAEe,MAAO,SAAWP,EACpC,GCjDagD,EAAA,CACd,MAAAzD,CAAOC,GACN,IAAIgD,EAAI9H,KAAK2D,QACTqB,EAAK8C,EAAE7C,MACPC,EAAO4C,EAAEzH,MAAM8E,UACnB,IAAKD,EACJ,OACD,IAAIE,EAAWF,EAAK3E,YAChB8E,EAAYH,EAAK1E,aACjB8E,EAAQ,GACRd,EAAI7F,EACR,MAAM6G,EAASsC,EAAEtC,OACjB,IAAK,MAAMwB,KAAKc,EAAEb,eAAgB,CACjC,IAAIlD,EAAIyB,EACJ0B,EAAKlH,KAAK2D,QAAQwD,UAAUH,GAChC,IAAK,MAAMlB,KAAKgC,EAAE/B,kBAAmB,CACpC,IAAIC,EAAS5H,EAAS0H,GAClBG,EAAK6B,EAAE5B,SAASJ,GACpB,MAAMiC,EAAU,GAAG/B,IAASgB,EAAI,IAChC,IAAIV,EAAOtB,EAAGgD,MAAMD,GACpB,GAAIzB,EAAM,CACT,GAAIA,EAAKC,QAAU,GAAKD,EAAKc,QAAU,EAAG,CACzC,IAAInD,EAAKgC,EACLvB,EAAKwC,EACT,IAAK,IAAIe,EAAK,EAAGA,EAAK3B,EAAKC,QAAS0B,IACnChE,GAAM6D,EAAE5B,SAAS+B,EAAKnC,GACvB,IAAK,IAAIoC,EAAK,EAAGA,EAAK5B,EAAKc,QAASc,IACnCxD,GAAMoD,EAAEX,UAAUe,EAAKlB,GACxB1B,EAAMM,KAAKd,EAAE,MAAO,CACnBe,MAAO,UACPa,MAAO,CAAE9F,KAAMlC,EAAKqF,EAAI,GAAIjD,IAAKpC,EAAK8F,EAAI,GAAI3D,MAAOnC,EAAKuF,EAAK,GAAIlD,OAAQrC,EAAKgG,EAAK,MAEtF,CACD,IAAIyD,EAAU,OAASL,EAAEM,UAAU9B,GACnChB,EAAMM,KAAKd,EAAE,MAAO,CACnBe,MAAOsC,EACPzB,MAAO,CAAE9F,KAAMlC,EAAKqF,GAAIjD,IAAKpC,EAAK8F,GAAI3D,MAAOnC,EAAKuH,EAAK,GAAIlF,OAAQrC,EAAKwI,EAAK,KAE7EZ,EAAK+B,SACN,CAED,GADAtE,GAAKkC,EACDlC,GAAKqB,EACR,KACD,CAED,GADAZ,GAAK0C,EACD1C,GAAKa,EACR,KACD,CACD,OAAOP,EAAE,MAAO,CAAEe,MAAO,SAAWP,EACpC,GCjDaiD,EAAA,CACd,MAAA1D,CAAOC,GACN,IAAIuB,EAAMrG,KAAK2D,QAAQsB,MAAMuD,WACzBC,EAAK,GACT,IAAK,IAAIC,EAAI,EAAGA,EAAIrC,EAAIsC,OAAQD,IAAK,CACpC,IAAItI,EAAIiG,EAAIqC,GACR1B,EAAIhH,KAAK2D,QAAQiF,QAAQxI,GAC7B,GAAI4G,GAAKA,EAAEpG,MAAQ,GAAKoG,EAAElG,KAAO,EAAG,CACnC,IAAK,IAAI+H,EAAKzI,EAAEQ,KAAO,EAAGiI,EAAKzI,EAAEqF,MAAOoD,IACvC7B,EAAEnG,OAASb,KAAK2D,QAAQuC,SAAS2C,GAClC,IAAK,IAAIC,EAAK1I,EAAEU,IAAM,EAAGgI,EAAK1I,EAAEsF,OAAQoD,IACvC9B,EAAEjG,QAAUf,KAAK2D,QAAQwD,UAAU2B,GACpC,IAAI3C,EAAM,OACN/F,EAAEsF,OAAStF,EAAEU,IAAM,GAAKV,EAAEqF,MAAQrF,EAAEQ,KAAO,KAC9CuF,GAAO,aACRsC,EAAG7C,KAAKd,EAAE,MAAO,CAAEe,MAAOM,EAAKO,MAAO,CAAE9F,KAAMlC,EAAKsI,EAAEpG,MAAOE,IAAKpC,EAAKsI,EAAElG,KAAMD,MAAOnC,EAAKsI,EAAEnG,MAAQ,GAAIE,OAAQrC,EAAKsI,EAAEjG,OAAS,MAChI,CACD,CACD,OAAO+D,EAAE,MAAO,CAAEe,MAAO,cAAgB4C,EACzC,GCnBaM,EAAA,CACd3H,QAAS,CACR,IAAA4H,CAAKtH,GACI1B,KAAK2D,QACXsF,QAAQvH,EAAGI,OAAOoH,UACpB,GAEF,MAAArE,CAAOC,GACN,IAAIgD,EAAI9H,KAAK2D,QACTqD,EAAIc,EAAEqB,SACNpB,EAAU,GAAG3J,EAAS4I,EAAElB,KAAKkB,EAAEA,EAAI,IACnCV,EAAOwB,EAAE7C,MAAM+C,MAAMD,GACzB,OAAOjD,EAAE,MAAO,CACfe,MAAO,wBAA0BiC,EAAEM,UAAU9B,GAC7CI,MAAO,CAAE9F,KAAMlC,EAAKsI,EAAEoC,EAAI,GAAItI,IAAKpC,EAAKsI,EAAEqC,EAAI,GAAIxI,MAAOnC,EAAKsI,EAAEsC,EAAI,GAAIvI,OAAQrC,EAAKsI,EAAElC,EAAI,IAC3FyE,SAAU,CAAEC,iBAAiB,GAC7B7C,GAAI,CAAEqC,KAAMhJ,KAAKgJ,OACflB,EAAE2B,SACL,EACD,OAAA3G,GACC9C,KAAK0J,IAAIC,OACT,GCjBa,IAAAC,EAAA,CACd9K,SAPuB,gJAQvBC,MAAO,CACN,EACDqC,QAAS,CACR,MAAAyI,CAAOC,GACN,IACIzD,EADQrG,KAAK2D,QAAQsB,MACTuD,WAChB,IAAKnC,EAAIsC,OAAQ,OAGjB,IAAK,IAAIT,KAAM7B,EACd,IAAK,IAAIW,EAAIkB,EAAGpH,IAAKkG,EAAIkB,EAAGxC,OAAQsB,IACnC,IAAK,IAAIlB,EAAIoC,EAAGtH,KAAMkF,EAAIoC,EAAGzC,MAAOK,IACnC9F,KAAK2D,QAAQoG,QAAQjE,EAAGkB,GAAIV,GAAS1H,IAAIuF,IAAImC,EAAMwD,EAL5C,OACG,KAQb,ICSHlL,IAAIC,UAAU,iBAAkB,CAC/BC,SApB2B,8zBAqB3BkL,WAAY,CACX,YAAajH,EACb,UAAW8E,EACX,WAAYS,EACZ,eAAgBC,EAChB,UAAWQ,EACX,aAAca,GAEf7K,MAAO,CACNkG,MAAOgF,OACP1C,UAAW,CAAE2C,KAAMjL,QAASkL,SAAS,GACrCxE,QAAS,CAAEuE,KAAMjL,QAASkL,SAAS,GACnCC,UAAWnL,QACXoL,SAAU,CAAEH,KAAMjL,QAASkL,SAAS,IAErC1K,KAAI,KACI,CACN6K,YAAa,EACbC,UAAW,CAAExG,EAAG,EAAGS,EAAG,GACtBgG,SAAS,EACTC,WAAW,EACXtB,SAAU,CAAEC,EAAG,EAAGC,EAAG,EAAGC,EAAG,EAAGxE,EAAG,EAAGgB,EAAG,GAAIkB,GAAG,GAC9CyC,SAAU,GACViB,SAAU,CAAE5E,EAAG,EAAGkB,EAAG,KAGvBlH,SAAU,CACT,MAAA0F,GACC,OR5D2B,IQ4DFxF,KAAKoK,UAnDX,GAmDuC,EAC1D,GAEFhJ,QAAS,CACR,YAAAmD,CAAaoG,GACZ,IAAInG,EAAI7F,EACR,IAAK,MAAMqI,KAAKhH,KAAKiH,eAAgB,CACpC,IAAIC,EAAKlH,KAAKmH,UAAUH,GACxB,GAAI2D,GAAUnG,GAAKmG,GAAWnG,EAAI0C,EACjC,MAAO,CAAE5C,IAAK0C,EAAGlG,IAAK0D,EAAGzD,OAAQmG,GAClC1C,GAAK0C,CACL,CACD,OAAO,IACP,EACD,YAAApD,CAAa8G,GACZ,IAAI7G,EAAI/D,KAAKwF,OACb,IAAK,MAAMM,KAAK9F,KAAK+F,kBAAmB,CACvC,IAAIE,EAAKjG,KAAKkG,SAASJ,GACvB,GAAI8E,GAAU7G,GAAK6G,GAAW7G,EAAIkC,EACjC,MAAO,CAAEpC,IAAKiC,EAAGlF,KAAMmD,EAAGlD,MAAOoF,GAClClC,GAAKkC,CACL,CACD,OAAO,IACP,EACD,QAAAC,CAASJ,GACR,IAAIjC,EAAM7D,KAAKiF,MAAMwB,QAAQrI,EAAS0H,IACtC,OAAOjC,EAAMA,EAAIgH,MAhFM,GAiFvB,EACD,SAAA1D,CAAUH,GACT,IAAI1C,EAAMtE,KAAKiF,MAAMoC,KAAKL,EAAI,GAC9B,OAAO1C,EAAMA,EAAIwG,OAnFK,EAoFtB,EACD,cAAAnG,CAAeqC,GACd,IAAI1C,EAAMtE,KAAKiF,MAAMoC,KAAKL,EAAI,GAK9B,OAJK1C,IACJA,EAAM,CAAA,EACN1F,IAAIuF,IAAInE,KAAKiF,MAAMoC,KAAML,EAAI,EAAG1C,IAE1BA,CACP,EACD,iBAAAJ,CAAkB4B,GACjB,IAAIE,EAAS5H,EAAS0H,GAClBjC,EAAM7D,KAAKiF,MAAMwB,QAAQT,GAK7B,OAJKnC,IACJA,EAAM,CAAA,EACNjF,IAAIuF,IAAInE,KAAKiF,MAAMwB,QAAST,EAAQnC,IAE9BA,CACP,EACD,OAAA+E,CAAQxI,GACP,IAAI2K,EAAK3K,EAAEQ,KAAUoK,EAAK5K,EAAEU,IACxB0D,EAAI7F,EACJwD,EAAO,CAAEvB,KAAM,EAAGE,IAAK,EAAGC,OAAQ,EAAGF,MAAO,GAChD,IAAK,MAAMmG,KAAKhH,KAAKiH,eAAgB,CACpC,IAAIC,EAAKlH,KAAKmH,UAAUH,GACxB,GAAIA,IAAMgE,EAAI,CACb7I,EAAKrB,IAAM0D,EAAGrC,EAAKpB,OAASmG,EAC5B,KACA,CACI,GAAIF,EAAIgE,EACZ,MACDxG,GAAK0C,CACL,CACD,IAAInD,EAAI/D,KAAKwF,OACb,IAAK,MAAMM,KAAK9F,KAAK+F,kBAAmB,CACvC,IAAIE,EAAKjG,KAAKkG,SAASJ,GACvB,GAAIA,IAAMiF,EAAI,CACb5I,EAAKvB,KAAOmD,EAAG5B,EAAKtB,MAAQoF,EAC5B,KACA,CACI,GAAIH,EAAIiF,EACZ,MACDhH,GAAKkC,CACL,CACD,OAAO9D,CACP,EACD,cAAAyB,CAAelC,GACd,IACIS,EADOnC,KAAKK,MAAM8E,UACN/C,wBACZoC,EAAI9C,EAAGa,QAAUJ,EAAKrB,IAE1B,MAAO,CAAEiD,EADDrC,EAAGY,QAAUH,EAAKvB,KACd4D,IACZ,EACD,OAAAyG,CAAQ7L,GACPY,KAAKuK,UAAUxG,EAAI3E,CACnB,EACD,OAAA8L,CAAQ9L,GACPY,KAAKuK,UAAU/F,EAAIpF,CACnB,EACD6H,aAAc,YACb,IAAIjC,EAAKhF,KAAKiF,MACd,IAAK,IAAIkG,EAAI,EAAGA,EAAInG,EAAG0C,MAAML,KAAM8D,UAC5BA,EACP,IAAK,IAAIA,EAAInL,KAAKuK,UAAU/F,EAAG2G,EAAInG,EAAGwB,KAAKa,KAAsB8D,UAC1DA,CACP,EACDpF,gBAAiB,YAChB,IAAIf,EAAKhF,KAAKiF,MACd,IAAK,IAAIa,EAAI,EAAGA,EAAId,EAAG0C,MAAMjB,QAASX,UAC/BA,EACP,IAAK,IAAIA,EAAI9F,KAAKuK,UAAUxG,EAAG+B,EAAId,EAAGwB,KAAKC,QAA4BX,UAChEA,CACP,EACD,MAAAvG,CAAOuG,EAAGkB,GACT,IAAIoE,EAAKpL,KAAKiF,MAAMuD,WACpB,IAAK4C,IAAOA,EAAGzC,OAAQ,OACvB,IAAItC,EAAM+E,EAAG,GACTpG,EAAKhF,KAAKiF,MACJD,EAAG0C,MACb,IAAIhH,EAAKsE,EAAGwB,KACRV,EAAI,IAAGA,EAAI,GACXA,EAAIpF,EAAG+F,QAAU,IAAGX,EAAIpF,EAAG+F,QAAU,GACrCO,EAAI,IAAGA,EAAI,GACXA,EAAItG,EAAG2G,KAAO,IAAGL,EAAItG,EAAG2G,KAAO,GACnChB,EAAIzF,KAAOkF,EAAGO,EAAIZ,MAAQK,EAAI,EAC9BO,EAAIvF,IAAMkG,EAAGX,EAAIX,OAASsB,EAAI,EAC9BhH,KAAKqL,cACL,EACD,UAAAC,CAAW5J,GACV,IAAI6J,IAAW7J,EAAG6J,OAAS,KAAK1I,UAE/B7C,KAAKuK,UAAU/F,EADZ+G,EAAS,EACO/M,KAAKa,IAAIW,KAAKuK,UAAU/F,EAAI+G,EAAQvL,KAAKiF,MAAMuB,KAAKa,KAAOrH,KAAKwL,mBAEhEhN,KAAKc,IAAIU,KAAKuK,UAAU/F,EAAI+G,EAAQvL,KAAKiF,MAAMyC,MAAML,KACzE,EACD,OAAAoE,CAAQ/J,GACP,IAAI0J,EAAKpL,KAAKiF,MAAMuD,WACpB,IAAK4C,IAAOA,EAAGzC,OAAQ,OACvB,IAAItC,EAAM+E,EAAG,GACb,OAAQ1J,EAAGgK,OACV,KAAK,GACJ1L,KAAKT,OAAO8G,EAAIzF,KAAO,EAAGyF,EAAIvF,KAC9B,MACD,KAAK,GACJd,KAAKT,OAAO8G,EAAIzF,KAAMyF,EAAIvF,IAAM,GAChC,MACD,KAAK,GACJd,KAAKT,OAAO8G,EAAIzF,KAAO,EAAGyF,EAAIvF,KAC9B,MACD,KAAK,GACJd,KAAKT,OAAO8G,EAAIzF,KAAMyF,EAAIvF,IAAM,GAChC,MACD,KAAK,GACJd,KAAKT,OAAO8G,EAAIzF,KAAMyF,EAAIvF,IAAMd,KAAKwL,kBAAoBxL,KAAKiF,MAAMyC,MAAML,MAC1E,MACD,KAAK,GACJrH,KAAKT,OAAO8G,EAAIzF,KAAMyF,EAAIvF,IAAMd,KAAKwL,mBACrC,MACD,KAAK,GACJxL,KAAKT,OAAO,EAAG8G,EAAIvF,KACnB,MACD,KAAK,GACJd,KAAKT,OAAOS,KAAKiF,MAAMuB,KAAKC,QAAU,EAAGJ,EAAIvF,KAC7C,MACD,KAAK,IACJ,IAAIoH,EAAKlI,KAAK4I,QAAQvC,GACtBrG,KAAK2L,OAAO,CAAE9H,IAAKwC,EAAIzF,KAAMA,KAAMsH,EAAGtH,KAAMC,MAAOqH,EAAGrH,OACrD,CAAEyD,IAAK+B,EAAIvF,IAAKA,IAAKoH,EAAGpH,IAAK8K,OAAQ1D,EAAGnH,SAEzC,MACD,QACCyG,QAAQC,IAAI/F,EAAGgK,OAGjB,EACD,OAAAG,CAAQC,EAAIC,GACX,IAAKD,IAAOC,EAAI,OAChB,IAAIhE,EAAU,GAAG3J,EAAS0N,EAAGjI,OAAOkI,EAAGzH,IAAM,IACzCgC,EAAOtG,KAAKiF,MAAM+C,MAAMD,GAC5B,GAAIzB,EAAM,CACT,GAAIA,EAAKC,QAAU,EAClB,IAAK,IAAIT,EAAI,EAAGA,EAAIQ,EAAKC,QAAST,IACjCgG,EAAGjL,OAASb,KAAKkG,SAAS4F,EAAGjI,IAAMiC,GACrC,GAAIQ,EAAKc,QAAU,EAClB,IAAK,IAAIJ,EAAI,EAAGA,EAAIV,EAAKc,QAASJ,IACjC+E,EAAGhL,QAAUf,KAAKmH,UAAU4E,EAAGzH,IAAM0C,EACvC,CACD,EACD,QAAAgF,CAAStK,GACR,GAAIA,EAAGuK,WAAWC,UAAUC,SAAS,SACpC,OACD,IAAIrE,EAAI9H,KAAK4D,eAAelC,GACxBoK,EAAK9L,KAAK8D,aAAagE,EAAE/D,GACzBgI,EAAK/L,KAAKuE,aAAauD,EAAEtD,GAC7BxE,KAAK6L,QAAQC,EAAIC,GACjB/L,KAAK2L,OAAOG,EAAIC,EAChB,EACD,OAAAhC,CAAQjE,EAAGkB,EAAG1D,EAAI8I,GACjB,IAAIrE,EAAU,GAAG3J,EAAS0H,KAAKkB,EAAI,IAC/BV,EAAOtG,KAAKiF,MAAM+C,MAAMD,IACvBzB,GAAQ8F,IACZ9F,EAAO,CAAA,EACP1H,IAAIuF,IAAInE,KAAKiF,MAAM+C,MAAOD,EAASzB,IAEhCA,GACHhD,EAAGgD,EACJ,EACD,OAAA2C,CAAQoD,GACP,IAAIrF,EAAIhH,KAAKmJ,SACTpB,EAAU,GAAG3J,EAAS4I,EAAElB,KAAKkB,EAAEA,EAAI,IACnCV,EAAOtG,KAAKiF,MAAM+C,MAAMD,GAC5B,GAAKzB,EAMJA,EAAK+B,QAAUgE,MANL,CACV,IAAKA,EAAK,OACV/F,EAAO,CAAE+B,QAASgE,GAClBzN,IAAIuF,IAAInE,KAAKiF,MAAM+C,MAAOD,EAASzB,EACnC,CAGD,EACDgG,UAAS,CAACxG,EAAGkB,KACL,CAAEuF,QAAS,WAEnB,MAAAZ,CAAOG,EAAIC,GACV,IAAKD,IAAOC,EAAI,OAEhB,IADU/L,KAAKsM,UAAUlO,EAAS0N,EAAGjI,KAAMkI,EAAGzH,KAE7C,OACD,IAAIkI,EAAKxM,KAAKmJ,SACdqD,EAAGpD,EAAI0C,EAAGlL,KACV4L,EAAGnD,EAAI0C,EAAGjL,IACV0L,EAAGlD,EAAIwC,EAAGjL,MACV2L,EAAG1H,EAAIiH,EAAGhL,OACVyL,EAAG1G,EAAIgG,EAAGjI,IACV2I,EAAGxF,EAAI+E,EAAGzH,IACV,IAAIwB,EAAI9F,KAAKiF,MAAM+C,MAAM,GAAG5J,EAAS0N,EAAGjI,OAAOkI,EAAGzH,IAAM,KAEvDtE,KAAKyJ,SADF3D,EACaA,EAAEuC,QAEF,GACjBrI,KAAKwK,SAAU,CAEf,EACD,WAAA5D,CAAYlF,GACX,GAAIA,EAAGuK,WAAWC,UAAUC,SAAS,SACpC,OACDzK,EAAGI,OAAOC,kBAAkBL,EAAGM,WAC/BhC,KAAKwK,SAAU,EACfxK,KAAKyJ,UAAW,EAChBzJ,KAAKyK,WAAY,EACjB,IAAIgC,EAAMzM,KAAKiF,MACXmG,EAAKqB,EAAIjE,WACTV,EAAI9H,KAAK4D,eAAelC,GAC5B,GAAIoG,EAAE/D,EAAI/D,KAAKwF,OAAQ,CACtB,IAAIuG,EAAK/L,KAAKuE,aAAauD,EAAEtD,GAC7B4G,EAAGzC,OAAS,EACZ,IAAI+D,EAAK,CAAE9L,KAAM,EAAGE,IAAKiL,EAAGzH,IAAKmB,MAAOgH,EAAIjG,KAAKC,QAAU,EAAGf,OAAQqG,EAAGzH,IAAM,GAC/E8G,EAAGxF,KAAK8G,EACR,MACI,GAAI5E,EAAEtD,EAAI7F,EAAoB,CAClC,IAAImN,EAAK9L,KAAK8D,aAAagE,EAAE/D,GAC7BqH,EAAGzC,OAAS,EACZ,IAAI+D,EAAK,CAAE9L,KAAMkL,EAAGjI,IAAK/C,IAAK,EAAG2E,MAAOqG,EAAGjI,IAAM,EAAG6B,OAAQ+G,EAAIjG,KAAKa,KAAO,GAC5E+D,EAAGxF,KAAK8G,EACR,KACI,CACJ,IAAIA,EAAK1M,KAAK2M,cAAc7E,EAAE/D,EAAG+D,EAAEtD,GAC/BkI,IACHtB,EAAGzC,OAAS,EACZyC,EAAGxF,KAAK8G,GACR1M,KAAK0K,SAAS3G,EAAI2I,EAAG9L,KACrBZ,KAAK0K,SAASlG,EAAIkI,EAAG5L,IAEtB,CACD,EACD,WAAAgG,CAAYpF,GACX,IAAK1B,KAAKyK,UAAW,OACrB,GAAI/I,EAAGuK,WAAWC,UAAUC,SAAS,SACpC,OACD,IAAIrE,EAAI9H,KAAK4D,eAAelC,GACxB0J,EAAKpL,KAAKiF,MAAMuD,WACpB,IAAK4C,IAAOA,EAAGzC,OAAQ,OACvB,IAAItC,EAAM+E,EAAG,GACb,GAAItD,EAAE/D,EAAI/D,KAAKwF,OACLxF,KAAKuE,aAAauD,EAAEtD,GAC7BgD,QAAQC,IAAI,oBAER,GAAIK,EAAEtD,EAAI7F,EACLqB,KAAK8D,aAAagE,EAAE/D,GAC7ByD,QAAQC,IAAI,sBAER,CACJ,IAAIiF,EAAK1M,KAAK2M,cAAc7E,EAAE/D,EAAG+D,EAAEtD,GAC/BkI,EAAG9L,MAAQZ,KAAK0K,SAAS3G,IAC5BsC,EAAIzF,KAAO8L,EAAG9L,KACdyF,EAAIZ,MAAQiH,EAAGjH,OACViH,EAAG9L,KAAOZ,KAAK0K,SAAS3G,EAC7BsC,EAAIzF,KAAO8L,EAAG9L,KAEdyF,EAAIZ,MAAQiH,EAAGjH,MACZiH,EAAG5L,KAAOd,KAAK0K,SAASlG,GAC3B6B,EAAIvF,IAAM4L,EAAG5L,IACbuF,EAAIX,OAASgH,EAAGhH,QACNgH,EAAG5L,IAAMd,KAAK0K,SAASlG,EACjC6B,EAAIvF,IAAM4L,EAAG5L,IAEbuF,EAAIX,OAASgH,EAAGhH,OACjB1F,KAAKqL,cACL,CACD,EACD,SAAAxE,CAAUnF,GACTA,EAAGI,OAAOC,kBAAkBL,EAAGM,WAC/BhC,KAAKyK,WAAY,EACjBzK,KAAK0K,SAAS3G,EAAI,EAClB/D,KAAK0K,SAASlG,EAAI,EAClBxE,KAAKqL,cACL,EACD,YAAAA,GACC,IAAID,EAAKpL,KAAKiF,MAAMuD,WACpB,IAAK4C,IAAOA,EAAGzC,OAAQ,OACvB,IAAItC,EAAM+E,EAAG,GACTlG,EAAOlF,KAAKK,MAAM8E,UAClByH,EAAS1H,EAAK3E,YAAc,EAC5BsM,EAAU3H,EAAK1E,aAAe,EAC9BsM,EAAM9M,KAAKiF,MAAMyC,MACjBgF,EAAK1M,KAAKuK,UACVrC,EAAK,KACT,GAAIwE,EAAGlI,EAAIsI,EAAIzF,MAAQhB,EAAIvF,IAAM4L,EAAGlI,EACnCkI,EAAGlI,EAAIhG,KAAKc,IAAI+G,EAAIvF,IAAKgM,EAAIzF,UACzB,CACJa,EAAKA,GAAMlI,KAAK4I,QAAQvC,GAChB6B,EAAGpH,IAAMoH,EAAGnH,OAAS,EACrB8L,IACPH,EAAGlI,GAAK,EACT,CACD,GAAIkI,EAAG3I,EAAI+I,EAAIrG,SAAWJ,EAAIzF,KAAO8L,EAAG3I,EACvC2I,EAAG3I,EAAIvF,KAAKc,IAAI+G,EAAIzF,KAAMkM,EAAIrG,aAC1B,CACJyB,EAAKA,GAAMlI,KAAK4I,QAAQvC,GAChB6B,EAAGtH,KAAOsH,EAAGrH,MAAQ,EACrB+L,IACPF,EAAG3I,GAAK,EACT,CACD,EACD,aAAA4I,CAAc5I,EAAGS,GAChB,IAAIuH,EAAK/L,KAAKuE,aAAaC,GACvBsH,EAAK9L,KAAK8D,aAAaC,GAC3B,GAAI+H,GAAMC,EAAI,CACb,IAAIhE,EAAU,GAAG3J,EAAS0N,EAAGjI,OAAOkI,EAAGzH,IAAM,IACzCgC,EAAOtG,KAAKiF,MAAM+C,MAAMD,GAC5B,MAAO,CAAEnH,KAAMkL,EAAGjI,IAAK/C,IAAKiL,EAAGzH,IAAKmB,MAAOqG,EAAGjI,IAAM,GAAKyC,GAAMC,QAAU,GAAK,GAAIb,OAAQqG,EAAGzH,IAAM,GAAKgC,GAAMc,QAAU,GAAK,GAC7H,CACD,OAAO,IACP,EACD,aAAAhB,CAAc9C,EAAIgD,GACjB,OAAOtG,KAAKiF,MAAMuD,WAAWuE,MAAKjH,GAAKxC,EAAGwC,EAAG9F,KAAKiF,MAAM+C,MAAM,GAAG5J,EAAS0H,EAAElF,QAAQkF,EAAEhF,IAAM,OAC5F,EACD,SAAAsH,CAAU9B,GACT,IAAKA,EAAM,MAAO,GAClB,IAAIR,EAAI,GAKR,OAJIQ,EAAK0G,OACRlH,GAAK,SACFQ,EAAK2G,SACRnH,GAAK,WACCA,CACP,EACD,eAAAoH,GACC,IAAIhI,EAAOlF,KAAKK,MAAM8E,UACtB,IAAKD,EACJ,OAAO,EACR,IAAInB,EAAI/D,KAAKwF,OACTlG,EAAM4F,EAAK3E,YACX4M,EAAO,EACX,IAAK,IAAIrH,KAAK9F,KAAK+F,kBAAmB,CAErC,GADAhC,GAAK/D,KAAKkG,SAASJ,GACf/B,EAAIzE,EACP,MACQwG,GAAK9F,KAAKiF,MAAMyC,MAAMjB,UAC9B0G,GAAQ,EACT,CAED,OAAOA,CACP,EACD,eAAA3B,GACC,IAAItG,EAAOlF,KAAKK,MAAM8E,UACtB,IAAKD,EACJ,OAAO,EACR,IAAIV,EAAI7F,EACJW,EAAM4F,EAAK1E,aACX4M,EAAO,EACX,IAAK,IAAIpG,KAAKhH,KAAKiH,eAAgB,CAElC,GADAzC,GAAKxE,KAAKmH,UAAUH,GAChBxC,EAAIlF,EACP,MACQ0H,GAAKhH,KAAKiF,MAAMyC,MAAML,OAC9B+F,GAAQ,EACT,CAED,OAAOA,CACP,GAEF,OAAAtK,GACC9C,KAAKsK,aAAe,EAEpBtK,KAAKiF,MAAMuD,WAAW5C,KADb,CAAEhF,KAAM,EAAGE,IAAK,EAAG2E,MAAO,EAAGC,OAAQ,IAE9C1F,KAAKuK,UAAUxG,EAAI/D,KAAKiF,MAAMyC,MAAMjB,QACpCzG,KAAKuK,UAAU/F,EAAIxE,KAAKiF,MAAMyC,MAAML,KACpCrH,KAAKqN,KAAO,IAAIC,gBAAevJ,IAC9B/D,KAAKsK,aAAe,EACpBtK,KAAKqL,cAAc,IAEpBrL,KAAKqN,KAAKE,QAAQvN,KAAK0J,IACvB,EACD,aAAA8D,GACKxN,KAAKqN,MACRrN,KAAKqN,KAAKI,UAAUzN,KAAK0J,IAC1B"}